<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Booking - I ‚ù§Ô∏è Miami Concierge</title>
    <link rel="stylesheet" href="css/main.css">
    <!-- Development/Production Environment Styles -->
    <style>
      /* Hide dev-only elements by default (for production) */
      .dev-only {
        display: none !important;
      }
    </style>
    <!-- Script to detect development environment and show dev tools if needed -->
    <script>
      // Check if we're in a development environment
      const isDevelopment = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' ||
                           window.location.hostname.includes('192.168.') ||
                           window.location.hostname.includes('.local') ||
                           window.location.search.includes('debug=true');
      
      // If in development, add a class to the HTML element and enable dev-only elements
      if (isDevelopment) {
        document.documentElement.classList.add('development');
        // Add a style tag to show dev-only elements in development
        const style = document.createElement('style');
        style.textContent = '.dev-only { display: initial !important; }';
        document.head.appendChild(style);
        console.log('üîß Development environment detected - Debug tools enabled');
      } else {
        document.documentElement.classList.add('production');
        console.log('üöÄ Production environment detected - Debug tools disabled');
      }
    </script>
    <!-- Replace this CDN link -->
     <!-- TODO: Consolidate Tailwind CSS - currently using both CDN and local file 
     Need to rebuild local file with all required components before removing CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="css/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom-places.css">
    <!-- Airbnb-style booking button styles -->
    <style>
    /* Airbnb-style booking button container */
      .airbnb-booking-container {
        display: flex;
        max-width: 400px;
        border: 1px solid #dddddd;
        border-radius: 32px;
        overflow: hidden;
        background: white;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08), 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.2s ease;
        margin-bottom: 20px;
      }
        .booking-form-card {
        overflow: hidden;
      }

      .airbnb-booking-container:hover {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08), 0 8px 16px rgba(0, 0, 0, 0.1);
      }

      /* Individual booking buttons */
      .airbnb-booking-button {
        flex: 1;
        padding: 12px 16px !important;
        border: none;
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        min-height: 60px !important;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .airbnb-booking-button:hover {
        background: #f7f7f7;
      }

      .airbnb-booking-button.active {
        background: #f7f7f7;
        box-shadow: inset 0 0 0 2px #222222;
      }

      /* Left button active state with proper border radius */
      .airbnb-booking-button-left.active {
        border-radius: 32px 0 0 32px;
      }

      /* Right button active state with proper border radius */
      .airbnb-booking-button-right.active {
        border-radius: 0 32px 32px 0;
      }
      
      /* Experience Search Bar Styles */
      .experience-search-container { margin: 20px 0; width: 100%; }
      .experience-search-bar { background: white; border-radius: 32px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12); display: flex; align-items: center; border: 1px solid #dddddd; overflow: hidden; transition: all 0.3s ease; width: 100%; position: relative; }
      .experience-search-bar:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
      .experience-search-bar .search-section { flex: 1; padding: 12px 20px; display: flex; flex-direction: column; justify-content: center; cursor: pointer; transition: background-color 0.2s ease; border-right: 1px solid #dddddd; min-height: 56px; position: relative; }
      .experience-search-bar .search-section:first-child { background-color: #f7f7f7; border-radius: 32px 0 0 32px; }
      .experience-search-bar .search-section:nth-child(2) { flex: 1.2; background-color: white; }
      .experience-search-bar .search-section:nth-child(3) { background-color: #f7f7f7; border-right: none; border-radius: 0 32px 32px 0; padding-right: 12px; }
      .experience-search-bar .search-section:hover { background-color: #ebebeb; z-index: 1; }
      .experience-search-bar .search-label { font-size: 11px; font-weight: 600; color: #222222; margin-bottom: 2px; line-height: 1.2; }
      .experience-search-bar .search-value { font-size: 13px; font-weight: 400; color: #717171; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; }
      .experience-search-bar .search-value.has-value { color: #222222; font-weight: 500; }
      .experience-search-bar .search-button { background: linear-gradient(135deg, #FF385C 0%, #E61E4D 100%); border: none; border-radius: 50%; width: 40px; height: 40px; margin: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(255, 56, 92, 0.3); position: relative; z-index: 3; }
      .experience-search-bar .search-button:hover { transform: scale(1.04); box-shadow: 0 3px 10px rgba(255, 56, 92, 0.4); }
      .experience-search-bar .search-button svg { width: 14px; height: 14px; color: white; }

      @media (max-width: 768px) {
          .experience-search-bar { flex-direction: column; border-radius: 16px; }
          .experience-search-bar .search-section { border-right: none; border-bottom: 1px solid #dddddd; padding: 14px 18px; min-height: 50px; background-color: white !important; border-radius: 0 !important; }
          .experience-search-bar .search-section:first-child { border-radius: 16px 16px 0 0 !important; }
          .experience-search-bar .search-section:nth-child(3) { border-bottom: none; border-radius: 0 0 16px 16px !important; }
          .experience-search-bar .search-section:hover { border-radius: 0 !important; background-color: #f7f7f7 !important; }
          .experience-search-bar .search-button { margin: 10px; width: 36px; height: 36px; align-self: center; }
          .experience-search-bar .search-button svg { width: 12px; height: 12px; }
      }
    </style>
</head>

<body>
  <!-- Your page content here -->
  
  <!-- Experience tab content with location field and search bar -->
  <div id="panel-experience-plus" class="tab-panel space-y-3 hidden" role="tabpanel" tabindex="0" aria-labelledby="tab-button-experience-plus">
    <!-- EXPERIENCE+ TAB: Show only Starting Location -->
    <div id="location-fields-container-experience" class="space-y-4">
      <!-- Starting Location Only -->
      <div class="relative">
        <div class="google-maps-container">
          <label for="from-location-exp" class="location-label">Starting Location</label>
          <span class="location-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
          </span>
          <gmp-place-autocomplete id="from-location-exp" placeholder="Enter starting location..."></gmp-place-autocomplete>
        </div>
        <span id="from-location-exp-error" class="mt-1 block text-xs text-red-600 hidden"></span>
      </div>
      
      <!-- Enhanced Airbnb-style Search Bar -->
      <div class="experience-search-container">
        <div class="experience-search-bar" id="experienceSearchContainer">
          <div class="search-section" id="experienceLocationSection">
              <div class="search-label">Where</div>
              <div class="search-value" id="experienceLocationValue">Search destinations</div>
          </div>
          <div class="search-section" id="experienceDateSection">
              <div class="search-label">Date</div>
              <div class="search-value" id="experienceDateValue">Add dates</div>
          </div>
          <div class="search-section" id="experienceGuestSection">
              <div class="search-label">Who</div>
              <div class="search-value" id="experienceGuestValue">Add guests</div>
          </div>
          <button class="search-button" id="experienceSearchButton">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Date/time booking options container -->
  <div id="date-time-container-oneway" class="relative">
    <input type="hidden" name="booking_preference" id="booking-preference" value="">
      <div class="airbnb-booking-container">
      <button type="button" id="request-now-button" class="airbnb-booking-button airbnb-booking-button-left">
        <div class="airbnb-button-content">
          <div class="airbnb-button-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="airbnb-button-text">
            <div class="airbnb-button-title">Request Now</div>
            <div class="airbnb-button-subtitle">Available immediately</div>
          </div>
        </div>
      </button>
      
      <button type="button" id="book-later-button" class="airbnb-booking-button airbnb-booking-button-right">
        <div class="airbnb-button-content">
          <div class="airbnb-button-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 00-2-2V7a2 2 0 00-2-2H5a2 2 0 002 2z" />
            </svg>
          </div>
          <div class="airbnb-button-text">
            <div class="airbnb-button-title">Book for Later</div>
            <div class="airbnb-button-subtitle">Schedule your trip</div>
          </div>
        </div>
      </button>
    </div>
  </div>
  
  <div id="scheduled-booking-inputs" class="hidden mt-4 space-y-4">
    <!-- Date/time inputs appear here when "Book for Later" is selected -->
  </div>

  <!-- Scripts section -->
  <!-- Script for Airbnb-style booking button functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const requestNowButton = document.getElementById('request-now-button');
      const bookLaterButton = document.getElementById('book-later-button');

      function setActiveButton(activeButton, inactiveButton) {
        // Remove active class from both buttons
        requestNowButton.classList.remove('active');
        bookLaterButton.classList.remove('active');
        
        // Add active class to selected button
        activeButton.classList.add('active');
        
        // Preserve existing functionality - this maintains compatibility with the event system
        if (activeButton === requestNowButton) {
          // When "Request Now" is clicked
          if (window.formState && window.formState.oneway) {
            window.formState.oneway.bookingTime = true;
          }
          
          const bookingPrefInput = document.getElementById('booking-preference');
          if (bookingPrefInput) bookingPrefInput.value = 'now';
          
          const scheduledInputs = document.getElementById('scheduled-booking-inputs');
          if (scheduledInputs) scheduledInputs.classList.add('hidden');
          
          // Emit event if event bus is available
          if (window.eventBus) {
            window.eventBus.emit('form:booking-preference-changed', { preference: 'now', tab: 'oneway' });
          }
          
          console.log('üìÖ Request Now selected');
        } else {
          // When "Book for Later" is clicked
          if (window.formState && window.formState.oneway) {
            window.formState.oneway.bookingTime = false;
          }
          
          const bookingPrefInput = document.getElementById('booking-preference');
          if (bookingPrefInput) bookingPrefInput.value = 'later';
          
          const scheduledInputs = document.getElementById('scheduled-booking-inputs');
          if (scheduledInputs) scheduledInputs.classList.remove('hidden');
          
          // Emit event if event bus is available
          if (window.eventBus) {
            window.eventBus.emit('form:booking-preference-changed', { preference: 'later', tab: 'oneway' });
          }
          
          console.log('üìÖ Book for Later selected');
        }
        
        // Check form validity if the function exists
        if (typeof checkFormValidity === 'function') {
          checkFormValidity();
        }
      }

      // Make sure the requestNowButton and bookLaterButton exist before adding listeners
      if (requestNowButton && bookLaterButton) {
        requestNowButton.addEventListener('click', function() {
          setActiveButton(requestNowButton, bookLaterButton);
        });

        bookLaterButton.addEventListener('click', function() {
          setActiveButton(bookLaterButton, requestNowButton);
        });
        
        // Set default state (preserve existing default)
        // By default, we activate the "Request Now" button
        requestNowButton.click();
        
        console.log('‚úÖ Booking preference buttons initialized');
      } else {
        console.warn('‚ö†Ô∏è Booking preference buttons not found');
      }
      
      // Add shimmer effect when book-later button is clicked
      const scheduledInputs = document.getElementById('scheduled-booking-inputs');
      if (scheduledInputs && bookLaterButton) {
        function addShimmerEffect() {
          setTimeout(() => {
            if (scheduledInputs.offsetWidth) { // Force reflow
              scheduledInputs.style.transition = 'box-shadow 0.3s ease';
              scheduledInputs.style.boxShadow = '0 0 0 2px rgba(34, 34, 34, 0.2)';
              setTimeout(() => {
                scheduledInputs.style.boxShadow = '';
              }, 800);
            }
          }, 10);
        }
        
        bookLaterButton.addEventListener('click', addShimmerEffect);
      }
    });
  </script>

  <!-- Experience Search Bar Component -->
  <script>
    class ExperienceSearchBar {
      constructor() {
        this.selectedLocation = '';
        this.selectedDate = '';
        this.selectedGuests = '';
        this.init();
      }
      
      init() {
        this.bindEvents();
      }
      
      bindEvents() {
        document.getElementById('experienceLocationSection')?.addEventListener('click', () => {
          console.log('Experience location clicked');
        });
        document.getElementById('experienceDateSection')?.addEventListener('click', () => {
          console.log('Experience date clicked');
        });
        document.getElementById('experienceGuestSection')?.addEventListener('click', () => {
          console.log('Experience guest clicked');
        });
        document.getElementById('experienceSearchButton')?.addEventListener('click', () => {
          console.log('Experience search clicked');
          this.performSearch();
        });
      }
      
      performSearch() {
        const searchData = {
          location: this.selectedLocation,
          date: this.selectedDate,
          guests: this.selectedGuests
        };
        console.log('Experience search performed:', searchData);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        if (document.getElementById('experienceSearchContainer')) {
          new ExperienceSearchBar();
          console.log('‚úÖ Experience search bar initialized');
        }
      }, 100);
    });
  </script>
</body>
</html>
