<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Booking - I ‚ù§Ô∏è Miami Concierge</title>    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/fix-place-autocomplete.css">
    <!-- Development/Production Environment Styles -->
    <style>
      /* Hide dev-only elements by default (for production) */
      .dev-only {
        display: none !important;
      }
    </style>
    <!-- Script to detect development environment and show dev tools if needed -->
    <script>
      // Check if we're in a development environment
      const isDevelopment = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' ||
                           window.location.hostname.includes('192.168.') ||
                           window.location.hostname.includes('.local') ||
                           window.location.search.includes('debug=true');
      
      // If in development, add a class to the HTML element and enable dev-only elements
      if (isDevelopment) {
        document.documentElement.classList.add('development');
        // Add a style tag to show dev-only elements in development
        const style = document.createElement('style');
        style.textContent = '.dev-only { display: initial !important; }';
        document.head.appendChild(style);
        console.log('üîß Development environment detected - Debug tools enabled');
      } else {
        document.documentElement.classList.add('production');
        console.log('üöÄ Production environment detected - Debug tools disabled');
      }
    </script>
    <!-- Replace this CDN link -->
     <!-- TODO: Consolidate Tailwind CSS - currently using both CDN and local file 
     Need to rebuild local file with all required components before removing CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="css/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom-places.css">
    <!-- Airbnb-style booking button styles -->
    <style>
    /* Airbnb-style booking button container */
      .airbnb-booking-container {
        display: flex;
        max-width: 400px;
        border: 1px solid #dddddd;
        border-radius: 32px;
        overflow: hidden;
        background: white;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08), 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.2s ease;
        margin-bottom: 20px;
      }
        .booking-form-card {
        overflow: hidden;
      }

      .airbnb-booking-container:hover {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08), 0 8px 16px rgba(0, 0, 0, 0.1);
      }

      /* Individual booking buttons */
      .airbnb-booking-button {
        flex: 1;
        padding: 12px 16px !important;
        border: none;
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        min-height: 60px !important;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .airbnb-booking-button:hover {
        background: #f7f7f7;
      }

      .airbnb-booking-button.active {
        background: #f7f7f7;
        box-shadow: inset 0 0 0 2px #222222;
      }

      /* Left button active state with proper border radius */
      .airbnb-booking-button-left.active {
        border-radius: 32px 0 0 32px;
      }

      /* Right button active state with proper border radius */
      .airbnb-booking-button-right.active {
        border-radius: 0 32px 32px 0;
      }
      
      /* Experience Search Bar Styles */
      .experience-search-container { margin: 20px 0; width: 100%; }
      .experience-search-bar { background: white; border-radius: 32px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12); display: flex; align-items: center; border: 1px solid #dddddd; overflow: hidden; transition: all 0.3s ease; width: 100%; position: relative; }
      .experience-search-bar:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }      .experience-search-bar .search-section { flex: 1; padding: 12px 20px; display: flex; flex-direction: column; justify-content: center; cursor: pointer; transition: background-color 0.2s ease; border-right: 1px solid #dddddd; min-height: 56px; position: relative; }
      .experience-search-bar .search-section:first-child { background-color: #f7f7f7; border-radius: 32px 0 0 32px; flex: 1.2; }
      .experience-search-bar .search-section:nth-child(2) { flex: 1; background-color: white; }
      .experience-search-bar .search-section:nth-child(3) { background-color: #f7f7f7; border-right: none; border-radius: 0 32px 32px 0; padding-right: 12px; }
      .experience-search-bar .search-section:hover { background-color: #ebebeb; z-index: 1; }
      .experience-search-bar .search-section.selected { background-color: #f7f7f7; box-shadow: inset 0 0 0 2px #222222; z-index: 2; }
      .experience-search-bar .search-label { font-size: 11px; font-weight: 600; color: #222222; margin-bottom: 2px; line-height: 1.2; }
      .experience-search-bar .search-value { font-size: 13px; font-weight: 400; color: #717171; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; }
      .experience-search-bar .search-value.has-value { color: #222222; font-weight: 500; }
      .experience-search-bar .search-button { background: linear-gradient(135deg, #FF385C 0%, #E61E4D 100%); border: none; border-radius: 50%; width: 40px; height: 40px; margin: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(255, 56, 92, 0.3); position: relative; z-index: 3; }      .experience-search-bar .search-button:hover { transform: scale(1.04); box-shadow: 0 3px 10px rgba(255, 56, 92, 0.4); }
      .experience-search-bar .search-button svg { width: 14px; height: 14px; color: white; }      /* Specific styles for the booking timing bar */
      .booking-timing-bar .search-section:first-child { flex: 1.8; }
      .booking-timing-bar .search-section:nth-child(2) { flex: 1; }
      .booking-timing-bar .search-value { font-size: 14px; }
      .booking-timing-bar #requestNowValue { font-weight: 500; }      /* Modal Background Overlay */
      .experience-modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 100;
        transition: opacity 0.3s ease;
        opacity: 0;
      }
      .experience-modal-overlay.visible {
        display: block;
        opacity: 1;
      }

      /* Modal Container Styles */
      .experience-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95);
        background-color: white;
        border-radius: 16px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        z-index: 101;
        width: 90%;
        max-width: 550px;
        max-height: 80vh;
        overflow: hidden;
        transition: all 0.3s ease;
        opacity: 0;
      }
      .experience-modal.visible {
        display: block;
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      
      /* Modal Header */
      .experience-modal-header {
        padding: 16px 20px;
        border-bottom: 1px solid #dddddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .experience-modal-header h3 {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
      }
      .experience-modal-close {
        background: none;
        border: none;
        cursor: pointer;
        color: #717171;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
      }
      .experience-modal-close:hover {
        background-color: #f7f7f7;
      }
      
      /* Modal Content */
      .experience-modal-content {
        padding: 20px;
        max-height: calc(80vh - 70px);
        overflow-y: auto;
      }
      
      /* Location Search Styles */
      .location-search-input {
        width: 100%;
        padding: 12px 16px;
        font-size: 16px;
        border: 1px solid #dddddd;
        border-radius: 8px;
        margin-bottom: 16px;
        outline: none;
      }
      .location-search-input:focus {
        border-color: #222222;
        box-shadow: 0 0 0 1px #222222;
      }
      
      .location-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .location-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        cursor: pointer;
        border-radius: 8px;
        transition: background-color 0.2s;
      }
      .location-item:hover {
        background-color: #f7f7f7;
      }      /* This style applies to location icons in the location item list, 
      not the input field location icons which are controlled by custom-places.css */
      .location-icon {
        margin-right: 16px;
        width: 24px; /* Reduced from 40px to be more proportional */
        height: 24px; /* Reduced from 40px to be more proportional */
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f7f7f7;
        color: #717171;
      }
      .location-details h4 {
        margin: 0 0 4px 0;
        font-size: 14px;
        font-weight: 600;
      }
      .location-details p {
        margin: 0;
        font-size: 12px;
        color: #717171;
      }
      
      /* Date Picker Styles */
      .date-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }
      .date-option {
        flex: 1 0 calc(33.33% - 10px);
        padding: 10px;
        text-align: center;
        border: 1px solid #dddddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .date-option:hover {
        border-color: #222222;
      }
      .date-option.selected {
        background-color: #f7f7f7;
        border-color: #222222;
      }
      .date-option h4 {
        margin: 0 0 4px 0;
        font-size: 14px;
        font-weight: 600;
      }
      .date-option p {
        margin: 0;
        font-size: 12px;
        color: #717171;
      }
      
      .calendar-container {
        margin-top: 20px;
        max-width: 100%;
        overflow-x: auto;
      }
      
      /* Guest Selector Styles */
      .guest-category {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid #dddddd;
      }
      .guest-category:last-child {
        border-bottom: none;
      }
      .guest-info h4 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 500;
      }
      .guest-info p {
        margin: 0;
        font-size: 14px;
        color: #717171;
      }
      .guest-count {
        display: flex;
        align-items: center;
      }
      .guest-button {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 1px solid #dddddd;
        background: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }
      .guest-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .guest-button:hover:not(:disabled) {
        border-color: #222222;
      }
      .guest-count-value {
        margin: 0 16px;
        width: 20px;
        text-align: center;
        font-size: 16px;
      }
      
      /* Modal Footer */
      .experience-modal-footer {
        padding: 16px 20px;
        border-top: 1px solid #dddddd;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        background-color: white;
      }
      .modal-clear-btn {
        background: none;
        border: none;
        padding: 10px 16px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        text-decoration: underline;
        color: #222222;
      }
      .modal-save-btn {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        background: linear-gradient(135deg, #FF385C 0%, #E61E4D 100%);
        color: white;
        cursor: pointer;
        margin-left: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .modal-save-btn:hover {
        transform: scale(1.02);
        box-shadow: 0 2px 8px rgba(230, 30, 77, 0.3);
      }

      @media (max-width: 768px) {
          .experience-search-bar { flex-direction: column; border-radius: 16px; }
          .experience-search-bar .search-section { border-right: none; border-bottom: 1px solid #dddddd; padding: 14px 18px; min-height: 50px; background-color: white !important; border-radius: 0 !important; }
          .experience-search-bar .search-section:first-child { border-radius: 16px 16px 0 0 !important; }
          .experience-search-bar .search-section:last-child { border-bottom: none; border-radius: 0 0 16px 16px !important; }
          .experience-search-bar .search-section:hover { border-radius: 0 !important; background-color: #f7f7f7 !important; }
          .experience-search-bar .search-button { margin: 10px; width: 36px; height: 36px; align-self: center; }
          .experience-search-bar .search-button svg { width: 12px; height: 12px; }
          
          .experience-modal {
            width: 100%;
            max-width: none;
            top: auto;
            bottom: 0;
            left: 0;
            right: 0;
            transform: translateY(100%);
            border-radius: 16px 16px 0 0;
            max-height: 95vh;
          }
          .experience-modal.visible {
            transform: translateY(0);
          }
          .date-option {
            flex: 1 0 calc(50% - 10px);
          }
      }
    </style>
    <!-- Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd_O4s_73E_A8rq7TGCHKVEBFHzNecAHM&libraries=places&v=beta&loading=async"></script>

<!-- FIRST LOAD - at the top of the file -->
<script type="module">
  import eventBus from './src/core/EventBus.js';
  window.eventBus = eventBus;
  window.EventBus = eventBus.constructor;
  console.log('‚úÖ EventBus loaded and made global');
</script>
  
<!-- Core modules first -->
<script type="module" src="./core/EventDefinitions.js"></script>
<script type="module" src="./core/DOMManager.js"></script>
<script type="module" src="./core/ComponentRegistry.js"></script>

<!-- Essential functions before component loading -->
<script src="essential-functions.js"></script>

<!-- Component registration before dashboard.js -->
<script type="module" src="./dashboard-components.js"></script>

<!-- Application logic after components are registered -->
<script type="module" src="./dashboard.js"></script>
<script type="module" src="./simple-bridge.js"></script>
<script src="./js/booking-timing-bar.js"></script>

<!-- IMPORTANT: Delete this duplicate script loading section at the bottom of your HTML file -->
<!-- DELETE THIS SECTION
<script type="module" src="./core/EventDefinitions.js"></script>
<script type="module" src="./core/EventBus.js"></script>
<script type="module" src="./core/DOMManager.js"></script>
<script type="module" src="./core/ComponentRegistry.js"></script>
<script type="module" src="./dashboard-components.js"></script>
<script type="module" src="./dashboard.js"></script>
-->

<!-- Booking Timing Bar Component Script -->
<script src="./js/booking-timing-bar.js"></script>
  
  </head>
  <body class="bg-gray-100" style="background-image: url('images/miami-skyline-abstract-form.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
    <header class="site-header">
  <div class="header-container">    <!-- Logo -->
    <a href="index.html" class="site-logo">
      I ‚ù§Ô∏è <span class="brand-gradient-text">Miami</span>
    </a>

    <!-- Mobile menu toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Navigation menu -->
    <nav class="site-nav">
      <ul class="nav-list">
        <!-- Our experiences dropdown -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" aria-expanded="false">
            Our experiences
            <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
              <path fill="currentColor" d="M7 10l5 5 5-5z"/>
            </svg>
          </button>
          <ul class="dropdown-menu">
            <li><a href="yacht.html" class="dropdown-item">Yacht & boat</a></li>
            <li><a href="wynwood.html" class="dropdown-item">Tours & Excursions(comming soon)</a></li>
            <li><a href="airport.html" class="dropdown-item">Events(comming soon)</a></li>

          </ul>
        </li>

        <!-- Partner with us dropdown -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" aria-expanded="false">
            Partner With Us
            <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
              <path fill="currentColor" d="M7 10l5 5 5-5z"/>
            </svg>
          </button>
          <ul class="dropdown-menu">
            <li><a href="drivers.html" class="dropdown-item">Drivers(comming soon)</a></li>
            <li><a href="business.html" class="dropdown-item">Yatch Brokers(comming soon)</a></li>
            <li><a href="hotels.html" class="dropdown-item">Hotels & Resorts(coming soon)</a></li>
            <li><a href="events.html" class="dropdown-item">Event Planners(coming soon)</a></li>
          </ul>
        </li>  
            
          <!-- Direct links -->
        <li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" aria-expanded="false">
    Referral <span style="color: #00cc44;">$</span>
    <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
      <path fill="currentColor" d="M7 10l5 5 5-5z"/>
    </svg>
  </button>
  <ul class="dropdown-menu dropdown-menu-small">
    <li><a href="refer-driver.html" class="dropdown-item">Refer Driver(comming soon)</a></li>
    <li><a href="refer-friend.html" class="dropdown-item">Refer Friend(comming Soon)</a></li>
  </ul>
</li>

        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" aria-expanded="false">
            <svg class="inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="margin-right: 3px; vertical-align: -2px;">
      <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27Z"></path>
    </svg>
    Favorites
    <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
      <path fill="currentColor" d="M7 10l5 5 5-5z"/>
    </svg>
  </button>
  <ul class="dropdown-menu dropdown-menu-small">
    <li><a href="favorite-drivers.html" class="dropdown-item">Drivers(comming soon)</a></li>
    <li><a href="favorite-places.html" class="dropdown-item">Places(comming soon)</a></li>
  </ul>
</li>

        <!-- Language selector with SVG flags -->
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" aria-expanded="false">
    <span class="inline-flex items-center">
      <!-- USA Flag SVG -->
      <svg class="w-4 h-3 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7410 3900" style="width: 18px; height: 12px; margin-right: 5px; vertical-align: -1px;">
        <rect width="7410" height="3900" fill="#b22234"/>
        <path d="M0,450H7410m0,600H0m0,600H7410m0,600H0m0,600H7410m0,600H0" stroke="#fff" stroke-width="300"/>
        <rect width="2964" height="2100" fill="#3c3b6e"/>
      </svg>
      English
    </span>
    <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
      <path fill="currentColor" d="M7 10l5 5 5-5z"/>
    </svg>
  </button>
  <ul class="dropdown-menu dropdown-menu-small">
    <li>
      <a href="?lang=en" class="dropdown-item">
        <!-- USA Flag SVG -->
        <svg class="w-4 h-3 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7410 3900" style="width: 18px; height: 12px; margin-right: 5px; vertical-align: -1px;">
          <rect width="7410" height="3900" fill="#b22234"/>
          <path d="M0,450H7410m0,600H0m0,600H7410m0,600H0m0,600H7410m0,600H0" stroke="#fff" stroke-width="300"/>
          <rect width="2964" height="2100" fill="#3c3b6e"/>
        </svg>
        English
      </a>
    </li>
    <li>
      <a href="?lang=es" class="dropdown-item">
        <!-- Spain Flag SVG -->
        <svg class="w-4 h-3 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 500" style="width: 18px; height: 12px; margin-right: 5px; vertical-align: -1px;">
          <rect width="750" height="500" fill="#c60b1e"/>
          <rect width="750" height="250" y="125" fill="#ffc400"/>
        </svg>
        Espa√±ol
      </a>
    </li>
    <li>
      <a href="?lang=pt" class="dropdown-item">
        <!-- Brazil/Portuguese Flag SVG -->
        <svg class="w-4 h-3 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 504" style="width: 18px; height: 12px; margin-right: 5px; vertical-align: -1px;">
          <rect width="720" height="504" fill="#009b3a"/>
          <path d="M360,72 L620,252 L360,432 L100,252 Z" fill="#ffdf00"/>
          <circle cx="360" cy="252" r="80" fill="#002776" stroke="#fff" stroke-width="10"/>
        </svg>
        Portugu√™s
      </a>
    </li>
    <li>
      <a href="?lang=fr" class="dropdown-item">
        <!-- French Flag SVG -->
        <svg class="w-4 h-3 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" style="width: 18px; height: 12px; margin-right: 5px; vertical-align: -1px;">
          <rect width="300" height="600" fill="#002395"/>
          <rect width="300" height="600" x="300" fill="#fff"/>
          <rect width="300" height="600" x="600" fill="#ed2939"/>
        </svg>
        Fran√ßais
      </a>
    </li>
  </ul>
</li>

        <!-- Sign in -->
        <li class="nav-item">
          <a href="login.html" class="nav-link">Sign in</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

    <main>
      <!-- Left column - Hero content -->
      <div class="hero-content">
        <h1 class="text-4xl md:text-5xl font-bold mb-6" style="font-family: 'Playfair Display', serif; color: #333333; text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;">Time is Valuable Enjoy the moment</h1>
        <p class="text-xl mb-8" style="font-family: 'Playfair Display', serif; font-weight: bold; color: #97a9bb;">
  <span style="color: #ff0000; font-size: 1.5rem;">‚ù§Ô∏è</span> 
  The Uber of Experiences. Don't Just see it, live it.
</p>
      </div>
      
      <!-- Right column - Booking form -->
      <div class="booking-form-container">
        <div class="booking-form-card">
          <div id="tab-navigation" class="border-b border-gray-200">
  <nav class="-mb-px flex w-full" aria-label="Tabs" role="tablist">
    <button type="button" id="tab-button-oneway" data-tab-target="#panel-oneway" 
            class="tab-button" 
            role="tab" aria-selected="true" aria-controls="panel-oneway">One Way</button>
    <button type="button" id="tab-button-experience-plus" data-tab-target="#panel-experience-plus" 
            class="tab-button" 
            role="tab" aria-selected="false" aria-controls="panel-experience-plus">Experience +</button>
  </nav>
</div>

          <div class="form-padding">
            
            <form action="#" method="POST" id="booking-form" class="space-y-4">
              <div class="tab-panels space-y-3 pt-2">
                <div id="panel-oneway" class="tab-panel space-y-3" role="tabpanel" tabindex="0" aria-labelledby="tab-button-oneway">
                  <!-- ONE WAY TAB: Show both From and To locations -->
                  <div id="location-fields-container-oneway" class="space-y-4">
                    <!-- From Input -->
                    <div class="relative">
                      <div class="google-maps-container">
                        <label for="from-location" class="location-label">Starting Location</label>
                        <span class="location-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                          </svg>
                        </span>
                        <gmp-place-autocomplete id="from-location" placeholder="Enter pickup location..."></gmp-place-autocomplete>
                      </div>
                      <span id="from-location-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                    </div>

                    <!-- To Input -->
                    <div class="google-maps-container">
                      <label for="to-address" class="location-label">To</label>
                      <span class="location-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12 11.5A2.5 2.5 0 0 1 9.5 9A2.5 2.5 0 0 1 12 6.5A2.5 2.5 0 0 1 14.5 9a2.5 2.5 0 0 1-2.5 2.5M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7z"></path>
                        </svg>
                      </span>
                      <gmp-place-autocomplete id="to-address"
                        address-filter="country:us"
                        type-filter="establishment,geocode,airport,lodging,point_of_interest,tourist_attraction" 
                        placeholder="Enter drop-off location"
                        required
                        aria-describedby="to-address-error">
                      </gmp-place-autocomplete>
                      <span id="to-address-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                    </div>
                  </div>                  <div id="date-time-container-oneway" class="relative">
                    <input type="hidden" name="booking_preference" id="booking-preference" value="">
                      <div class="booking-timing-container">
                        <div class="experience-search-bar booking-timing-bar" id="bookingTimingContainer">
                          <div class="search-section" id="requestNowSection">
                              <div class="search-label">When</div>
                              <div class="search-value" id="requestNowValue">Request Now</div>
                          </div>
                          <div class="search-section" id="bookLaterSection">
                              <div class="search-label">Schedule</div>
                              <div class="search-value" id="bookLaterValue">Book for Later</div>
                          </div>
                          <button class="search-button" id="confirmTimingButton">
                              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                              </svg>
                          </button>
                        </div>
                      </div>
                  </div>
                  <span id="booking-time-error" class="mt-1 block text-xs text-red-600 hidden"></span>

                  <div id="scheduled-booking-inputs" class="hidden mt-4 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-4">
                      <div>
                         <label for="pickup-date-oneway" class="block text-xs font-medium text-gray-500 mb-0.5">Date</label>
                         <input type="text" name="pickup-date-oneway" id="pickup-date-oneway" aria-describedby="pickup-date-oneway-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Date..." />
                         <span id="pickup-date-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                      </div>                      <div>
                         <label for="pickup-time-oneway" class="block text-xs font-medium text-gray-500 mb-0.5">Time</label>
                         <select name="pickup-time-oneway" id="pickup-time-oneway" required aria-describedby="pickup-time-oneway-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm">
                            <option value="">Select Time...</option>
                            <option value="06:00 AM">6:00 AM</option>
                            <option value="06:30 AM">6:30 AM</option>
                            <option value="07:00 AM">7:00 AM</option>
                            <option value="07:30 AM">7:30 AM</option>
                            <option value="08:00 AM">8:00 AM</option>
                            <option value="08:30 AM">8:30 AM</option>
                            <option value="09:00 AM">9:00 AM</option>
                            <option value="09:30 AM">9:30 AM</option>
                            <option value="10:00 AM">10:00 AM</option>
                            <option value="10:30 AM">10:30 AM</option>
                            <option value="11:00 AM">11:00 AM</option>
                            <option value="11:30 AM">11:30 AM</option>
                            <option value="12:00 PM">12:00 PM</option>
                            <option value="12:30 PM">12:30 PM</option>
                            <option value="01:00 PM">1:00 PM</option>
                            <option value="01:30 PM">1:30 PM</option>
                            <option value="02:00 PM">2:00 PM</option>
                            <option value="02:30 PM">2:30 PM</option>
                            <option value="03:00 PM">3:00 PM</option>
                            <option value="03:30 PM">3:30 PM</option>
                            <option value="04:00 PM">4:00 PM</option>
                            <option value="04:30 PM">4:30 PM</option>
                            <option value="05:00 PM">5:00 PM</option>
                            <option value="05:30 PM">5:30 PM</option>
                            <option value="06:00 PM">6:00 PM</option>
                            <option value="06:30 PM">6:30 PM</option>
                            <option value="07:00 PM">7:00 PM</option>
                            <option value="07:30 PM">7:30 PM</option>
                            <option value="08:00 PM">8:00 PM</option>
                            <option value="08:30 PM">8:30 PM</option>
                            <option value="09:00 PM">9:00 PM</option>
                            <option value="09:30 PM">9:30 PM</option>
                            <option value="10:00 PM">10:00 PM</option>
                            <option value="10:30 PM">10:30 PM</option>
                            <option value="11:00 PM">11:00 PM</option>
                            <option value="11:30 PM">11:30 PM</option>
                        </select>
                         <span id="pickup-time-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                      </div>
                   </div>
                  </div>

                  <div id="vehicle-selection-oneway" class="vehicle-selection-container pt-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Select Your Vehicle</h3>
                    <fieldset aria-labelledby="vehicle-selection-oneway-label" aria-describedby="vehicle-type-oneway-error">
                       <legend class="sr-only">Vehicle Selection</legend>
                       <div class="space-y-3 divide-y divide-gray-200">

                         <label for="vehicle-sedan-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                           <div class="vehicle-card-content flex items-center space-x-4 w-full">
                             <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                               <img src="images/luxury-sedan.jpg" alt="Luxury Sedan" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">Luxury Sedan</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.412 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /></svg>
                                   <span class="font-medium">3</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">2</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Tesla Model Y</p>
                               <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-green-100] text-[--color-green-800]">EV Available</span>
                               </div>
                             </div>
                           </div>

                            <input type="radio" name="vehicle_type_oneway" value="Luxury Sedan" id="vehicle-sedan-card" class="sr-only" required aria-checked="false">
                         </label>

                         <label for="vehicle-suv-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                            <div class="vehicle-card-content flex items-center space-x-4 w-full">
                              <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                                <img src="images/premium-suv-escalade.jpg" alt="Premium SUV" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">Premium SUV</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.412 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /> </svg>
                                   <span class="font-medium">6</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">5</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Cadillac Escalade</p>
                                <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-green-100] text-[--color-green-800]">EV Available</span>
                               </div>
                             </div>
                           </div>

                            <input type="radio" name="vehicle_type_oneway" value="Premium SUV" id="vehicle-suv-card" class="sr-only" required aria-checked="false">
                         </label>

                         <label for="vehicle-sprinter-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                            <div class="vehicle-card-content flex items-center space-x-4 w-full">
                              <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                                <img src="images/vip-sprinter.jpg" alt="VIP Sprinter" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">VIP Group Sprinter</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.412 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /> </svg>
                                   <span class="font-medium">14</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75A3.75 3.75 0 0012 0h-4A3.75 3.75 0 004.25 3.75v.643c.57-.078 1.14-.145 1.71-.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">14</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Mercedes Sprinter</p>
                                <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-blue-100] text-[--color-blue-800]">Mobile Lounge</span>
                               </div>
                             </div>
                           </div>

                            <input type="radio" name="vehicle_type_oneway" value="VIP Group Sprinter" id="vehicle-sprinter-card" class="sr-only" required aria-checked="false">
                         </label>

                       </div> <span id="vehicle-type-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span> </fieldset>
                  </div>
                  </div>
                <div id="panel-experience-plus" class="tab-panel space-y-3 hidden" role="tabpanel" tabindex="0" aria-labelledby="tab-button-experience-plus">
                  <!-- EXPERIENCE+ TAB: Show only Starting Location -->
                  <div id="location-fields-container-experience" class="space-y-4">
                    <!-- Starting Location Only -->
                    <div class="relative">
                      <div class="google-maps-container">
                        <label for="from-location-exp" class="location-label">Starting Location</label>
                        <span class="location-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                          </svg>
                        </span>
                        <gmp-place-autocomplete id="from-location-exp" placeholder="Enter starting location..." style="max-width: 100%; width: 100%; height: auto;"></gmp-place-autocomplete>
                      </div>
                      <span id="from-location-exp-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                    </div>
                      <!-- Enhanced Airbnb-style Search Bar -->
                    <div class="experience-search-container">
                      <div class="experience-search-bar" id="experienceSearchContainer">
                        <div class="search-section" id="experienceDateSection">
                            <div class="search-label">Date</div>
                            <div class="search-value" id="experienceDateValue">Add dates</div>
                        </div>
                        <div class="search-section" id="experienceGuestSection">
                            <div class="search-label">Who</div>
                            <div class="search-value" id="experienceGuestValue">Add guests</div>
                        </div>
                        <button class="search-button" id="experienceSearchButton">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-action-buttons">
                <button type="button" id="reset-button" class="flex items-center text-gray-500 hover:text-[--color-teal] transition-colors duration-200 px-3 py-1.5 rounded-md hover:bg-gray-100">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Reset
                </button>
                <button type="submit" id="submit-button" disabled
                    class="flex items-center justify-center text-lg font-semibold"
                    title="Complete all required fields to enable submission" aria-disabled="true" aria-busy="false">
                    <span class="spinner hidden" aria-hidden="true"></span>
                    <span class="button-text">Continue</span>
                </button>
              </div>
            </form>

            <div id="confirmation-message" class="hidden text-center mt-6">
              <h3 class="font-playfair text-xl text-gray-900">Thank You!</h3>
              <p class="text-gray-600">Your request has been submitted successfully. We'll get back to you soon.</p>
            </div>
          </div>
        </div>
      </div>    </main>    
<!-- COMMENT OUT OR REMOVE this debug section before pushing to production -->
<!--
<div style="position: fixed; top: 10px; right: 10px; background: white; padding: 10px; border: 1px solid #ccc; z-index: 9999;">
  <h4>üîß Debug Controls</h4>
  <button onclick="forceLocationValidation('from-location', 'oneway', 'fromLocation')" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #10b981; color: white; border: none; border-radius: 4px;">
    ‚úÖ Force From Valid
  </button>
  <button onclick="forceLocationValidation('to-address', 'oneway', 'toAddress')" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #10b981; color: white; border: none; border-radius: 4px;">
    ‚úÖ Force To Valid
  </button>
  <button onclick="console.log('FormState:', window.formState)" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px;">
    üîç Check State
  </button>
  <button onclick="document.getElementById('vehicle-selection-oneway').classList.add('show')" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #059669; color: white; border: none; border-radius: 4px;">
    ‚ú® Add SHOW Class
  </button>
</div>
-->

<!-- Script for Booking Timing Bar Component -->
<script src="./js/booking-timing-bar.js"></script>

<!-- Script for Date/Time Input Visual Feedback Enhancements -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add icons to the date and time inputs
    const dateInput = document.getElementById('pickup-date-oneway');
    const timeInput = document.getElementById('pickup-time-oneway');
    
    if (dateInput) {
      const dateIconContainer = document.createElement('span');
      dateIconContainer.className = 'input-icon';
    }
    
    if (timeInput) {
      const timeIconContainer = document.createElement('span');
      timeIconContainer.className = 'input-icon';
      timeIconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/></svg>';
      timeInput.parentNode.style.position = 'relative';
      timeInput.parentNode.appendChild(timeIconContainer);
    }
    
    // Note: Shimmer effect for scheduled booking container is now handled by booking-timing-bar.js
  });
</script>

<!-- Enhanced Date/Time Input Behavior -->
<script>
// Enhanced Date/Time Input Behavior
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('pickup-date-oneway');
    const timeInput = document.getElementById('pickup-time-oneway');
    
    // Add filled class when inputs have values
    function updateInputState(input) {
        if (input && input.value.trim() !== '') {
            input.classList.add('filled');
        } else if (input) {
            input.classList.remove('filled');
        }
    }
    
    // Monitor input changes
    if (dateInput) {
        dateInput.addEventListener('change', () => updateInputState(dateInput));
        dateInput.addEventListener('input', () => updateInputState(dateInput));
        // Check initial state
        updateInputState(dateInput);
    }
    
    if (timeInput) {
        timeInput.addEventListener('change', () => updateInputState(timeInput));
        timeInput.addEventListener('input', () => updateInputState(timeInput));
        // Check initial state
        updateInputState(timeInput);
    }
      // Enhanced Flatpickr configuration for date picker only
    if (dateInput && typeof flatpickr !== 'undefined') {
        flatpickr(dateInput, {
            dateFormat: "M j, Y",
            minDate: "today",
            theme: "airbnb",
            animate: true,
            onChange: function(selectedDates, dateStr, instance) {
                updateInputState(dateInput);
                console.log('Date selected:', dateStr);
            }
        });
    }
    
    // Time picker now using standard dropdown select - no Flatpickr needed
    if (timeInput) {
        timeInput.addEventListener('change', function() {
            updateInputState(timeInput);
            console.log('Time selected:', timeInput.value);
        });
    }
});
</script>
<!-- Experience Search Bar Component -->
<script>
// Initialize the global experienceSearchBar variable
window.experienceSearchBar = null;

document.addEventListener('DOMContentLoaded', function() {
    // Wait for DOM to be fully loaded
    setTimeout(() => {
        // Make sure we have the search container
        if (document.getElementById('experienceSearchContainer')) {
            console.log('Initializing enhanced experience search bar');
        }
    }, 100);
});
</script>

<!-- Update the Experience Search Bar JavaScript to properly connect click events -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wait for DOM to be fully loaded, then initialize with a small delay to ensure all elements are rendered
  setTimeout(() => {
    // Only create one instance of the ExperienceSearchBar class
    if (document.getElementById('experienceSearchContainer')) {
      // Remove any previous initialization
      if (window.experienceSearchBar) {
        console.log('Existing search bar found, updating');
        
        // Re-initialize the component to ensure all event listeners are attached
        window.experienceSearchBar.init();
      } else {
        console.log('Initializing experience search bar');
        // Create and store the instance globally
        window.experienceSearchBar = new ExperienceSearchBar();
        window.experienceSearchBar.init(); // Initialize the component
      }
    }
  }, 200); // Increased delay to ensure DOM is fully loaded
});
</script>

<!-- Enhanced Debug Controls (only visible in development) -->
<div id="debug-controls" class="dev-only" style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.9); color: white; padding: 15px; border-radius: 8px; z-index: 9998; font-family: monospace; font-size: 12px; max-width: 300px; display: none;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <h4 style="margin: 0; color: #00ff88;">üîß Miami Concierge Debug Panel</h4>
    <div>
      <button id="debug-panel-minimize" style="background: none; border: none; color: white; cursor: pointer; font-size: 16px; padding: 0; margin-right: 5px;" title="Minimize panel">_</button>
      <button id="debug-panel-close" style="background: none; border: none; color: #ff3333; cursor: pointer; font-size: 18px; padding: 0; font-weight: bold;" title="Close panel">√ó</button>
    </div>
  </div>
  
  <div id="debug-panel-content">
    <div style="margin-bottom: 10px;">
      <strong style="color: #00bcd4;">Form Validation:</strong>
      <button onclick="forceLocationValidation('from-location', 'oneway', 'fromLocation')" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #10b981; color: white; border: none; border-radius: 3px; font-size: 11px;">
        ‚úÖ Force From Valid
      </button>
      <button onclick="forceLocationValidation('to-address', 'oneway', 'toAddress')" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #10b981; color: white; border: none; border-radius: 3px; font-size: 11px;">
        ‚úÖ Force To Valid
      </button>
      <button onclick="console.log('FormState:', window.formState)" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #3b82f6; color: white; border: none; border-radius: 3px; font-size: 11px;">
        üîç Check State
      </button>
    </div>
    
    <div style="margin-bottom: 10px;">
      <strong style="color: #ff9800;">Event Monitor:</strong>
      <button onclick="window.eventMonitor?.show()" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #9c27b0; color: white; border: none; border-radius: 3px; font-size: 11px;">
        üëÅÔ∏è Show Monitor
      </button>
      <button onclick="window.eventMonitor?.toggle()" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #9c27b0; color: white; border: none; border-radius: 3px; font-size: 11px;">
        üîÑ Toggle Monitor
      </button>
      <button onclick="window.eventMonitor?.clear()" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #9c27b0; color: white; border: none; border-radius: 3px; font-size: 11px;">
        üßπ Clear Events
      </button>
    </div>
    
    <div style="margin-bottom: 10px;">
      <strong style="color: #f44336;">Test Events:</strong>
      <button onclick="window.eventBus?.emit('error:show', {fieldId: 'test', message: 'Test error', severity: 'error'})" 
              style="display: block; margin: 3px 0; padding:  4px 8px; background: #f44336; color: white; border: none; border-radius: 3px; font-size: 11px;">
        üö® Test Error
      </button>
      <button onclick="window.eventBus?.emit('form:submission:started', {test: true})" 
              style="display: block; margin: 3px 0; padding: 4px 8px; background: #4caf50; color: white; border: none; border-radius: 3px; font-size: 11px;">
        üìù Test Form Event
      </button>
    </div>
    
    <div style="font-size: 10px; color: #888; margin-top: 10px;">
      Ctrl+Shift+E = Toggle Monitor<br>
      Ctrl+Shift+D = Toggle Debug Panel
    </div>
  </div>
</div>

<!-- Debug Panel Toggle Button - Now positioned above the architecture badge -->
<button id="debug-panel-toggle" style="position: fixed; bottom: 60px; left: 10px; background: rgba(220, 38, 38, 0.9); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; z-index: 9997; display: none; box-shadow: 0 2px 4px rgba(0,0,0,0.3);" title="Toggle Debug Panel" class="dev-only">
  üîß
</button>

<!-- Event-Driven Architecture Badge (Development Only) - Bottom Left Corner -->
<div class="architecture-badge-floating dev-only" title="Built with Event-Driven Architecture" onclick="showEventArchitecture()">
  <div class="badge-content">
    <svg class="badge-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      <path d="M12 7L7 10V14L12 17L17 14L12 7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
    </svg>
    <span class="badge-text">Event-Driven Architecture</span>
    <div class="pulse-ring"></div>
  </div>
</div>

<button id="inspector-toggle" class="inspector-toggle dev-only">üîç</button>
<script>
// Debug panel toggle functionality
document.addEventListener('DOMContentLoaded', function() {
  const debugPanel = document.getElementById('debug-controls');
  const debugToggle = document.getElementById('debug-panel-toggle');
  const debugMinimize = document.getElementById('debug-panel-minimize');
  const debugClose = document.getElementById('debug-panel-close');
  const debugContent = document.getElementById('debug-panel-content');
  
  // Only show debug controls in development environments
  const isDevelopment = window.location.hostname === 'localhost' || 
                        window.location.hostname === '127.0.0.1' ||
                        window.location.hostname.includes('192.168.') ||
                        window.location.hostname.includes('.local') ||
                        window.location.search.includes('debug=true');
                        
  if (debugToggle && isDevelopment) {
    // Show the toggle button only in development
    debugToggle.style.display = 'block';
    
    // Toggle debug panel when button is clicked
    debugToggle.addEventListener('click', function() {
      if (debugPanel) {
        debugPanel.style.display = 'block';
        debugToggle.style.display = 'none';
      }
    });
  }

  if (debugClose) {
    // Close debug panel when close button is clicked
    debugClose.addEventListener('click', function() {
      if (debugPanel) {
        debugPanel.style.display = 'none';
        debugToggle.style.display = 'block';
      }
    });
  }

  if (debugMinimize) {
    // Minimize debug panel when button is clicked
    debugMinimize.addEventListener('click', function() {
      if (debugContent) {
        if (debugContent.style.display === 'none') {
          // Expand
          debugContent.style.display = 'block';
          debugMinimize.textContent = '_';
          debugMinimize.title = 'Minimize panel';
        } else {
          // Minimize
          debugContent.style.display = 'none';
          debugMinimize.textContent = '‚ñ°';
          debugMinimize.title = 'Expand panel';
        }
      }
    });
  }
  // Add keyboard shortcut to toggle debug panel (Ctrl+Shift+D) - only in development
  if (isDevelopment) {
    document.addEventListener('keydown', function(event) {
      if (event.ctrlKey && event.shiftKey && event.key === 'D') {
        event.preventDefault();
        if (debugPanel.style.display === 'none') {
          debugPanel.style.display = 'block';
          debugToggle.style.display = 'none';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 } else {
          debugPanel.style.display = 'none';
          debugToggle.style.display = 'block';
        }
      }    });
  }
});
</script>

<!-- Experience Search Bar Modals -->
<!-- Modal Overlay -->
<div class="experience-modal-overlay" id="experienceModalOverlay"></div>

<!-- Location Modal -->
<div class="experience-modal" id="experienceLocationModal">
  <div class="experience-modal-header">
    <h3>Where are you going?</h3>
    <button class="experience-modal-close" id="locationModalClose">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>
  <div class="experience-modal-content">
    <input type="text" class="location-search-input" id="locationSearchInput" placeholder="Search destinations">
    <ul class="location-list" id="locationList">
      <li class="location-item" data-location="Miami">
        <div class="location-icon">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 4z"/>
          </svg>
        </div>
        <div class="location-details">
          <h4>Miami</h4>
          <p>Florida, United States</p>
        </div>
      </li>
      <li class="location-item" data-location="South Beach">
        <div class="location-icon">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 4z"/>
          </svg>
        </div>
        <div class="location-details">
          <h4>South Beach</h4>
          <p>Miami Beach, Florida</p>
        </div>
      </li>
      <li class="location-item" data-location="Miami Design District">
        <div class="location-icon">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 4z"/>
          </svg>
        </div>
        <div class="location-details">
          <h4>Miami Design District</h4>
          <p>Miami, Florida</p>
        </div>
      </li>
      <li class="location-item" data-location="Wynwood">
        <div class="location-icon">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 4z"/>
          </svg>
        </div>
        <div class="location-details">
          <h4>Wynwood</h4>
          <p>Miami, Florida</p>
        </div>
      </li>
    </ul>
  </div>
  <div class="experience-modal-footer">
    <button class="modal-clear-btn" id="locationClearBtn">Clear</button>
    <button class="modal-save-btn" id="locationSaveBtn">Save</button>
  </div>
</div>

<!-- Date Modal -->
<div class="experience-modal" id="experienceDateModal">
  <div class="experience-modal-header">
    <h3>When do you want to go?</h3>
    <button class="experience-modal-close" id="dateModalClose">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>
  <div class="experience-modal-content">
    <div class="date-options">
      <div class="date-option" data-date="today">
        <h4>Today</h4>
        <p id="todayDate"></p>
      </div>
      <div class="date-option" data-date="tomorrow">
        <h4>Tomorrow</h4>
        <p id="tomorrowDate"></p>
      </div>
      <div class="date-option" data-date="weekend">
        <h4>This weekend</h4>
        <p id="weekendDate"></p>
      </div>
      <div class="date-option" data-date="nextWeek">
        <h4>Next week</h4>
        <p id="nextWeekDate"></p>
      </div>
      <div class="date-option" data-date="nextMonth">
        <h4>Next month</h4>
        <p id="nextMonthDate"></p>
      </div>
      <div class="date-option" data-date="flexible">
        <h4>I'm flexible</h4>
        <p>Show calendar</p>
      </div>
    </div>
    <div class="calendar-container" id="experienceCalendar"></div>
  </div>
  <div class="experience-modal-footer">
    <button class="modal-clear-btn" id="dateClearBtn">Clear</button>
    <button class="modal-save-btn" id="dateSaveBtn">Save</button>
  </div>
</div>

<!-- Guest Modal -->
<div class="experience-modal" id="experienceGuestModal">
  <div class="experience-modal-header">
    <h3>Who's coming?</h3>
    <button class="experience-modal-close" id="guestModalClose">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>
  <div class="experience-modal-content">
    <div class="guest-category">
      <div class="guest-info">
        <h4>Adults</h4>
        <p>Ages 13+</p>
      </div>
      <div class="guest-count">
        <button class="guest-button" id="adultDecrease" disabled>
          <svg width="12" height="2" viewBox="0 0 12 2" fill="none">
            <rect width="12" height="2" rx="1" fill="currentColor"/>
          </svg>
        </button>
        <span class="guest-count-value" id="adultCount">0</span>
        <button class="guest-button" id="adultIncrease">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
            <rect y="5" width="12" height="2" rx="1" fill="currentColor"/>
            <rect x="5" width="2" height="12" rx="1" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="guest-category">
      <div class="guest-info">
        <h4>Children</h4>
        <p>Ages 2-12</p>
      </div>
      <div class="guest-count">
        <button class="guest-button" id="childDecrease" disabled>
          <svg width="12" height="2" viewBox="0 0 12 2" fill="none">
            <rect width="12" height="2" rx="1" fill="currentColor"/>
          </svg>
        </button>
        <span class="guest-count-value" id="childCount">0</span>
        <button class="guest-button" id="childIncrease">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
            <rect y="5" width="12" height="2" rx="1" fill="currentColor"/>
            <rect x="5" width="2" height="12" rx="1" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="guest-category">
      <div class="guest-info">
        <h4>Infants</h4>
        <p>Under 2</p>
      </div>
      <div class="guest-count">
        <button class="guest-button" id="infantDecrease" disabled>
          <svg width="12" height="2" viewBox="0 0 12 2" fill="none">
            <rect width="12" height="2" rx="1" fill="currentColor"/>
          </svg>
        </button>
        <span class="guest-count-value" id="infantCount">0</span>
        <button class="guest-button" id="infantIncrease">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
            <rect y="5" width="12" height="2" rx="1" fill="currentColor"/>
            <rect x="5" width="2" height="12" rx="1" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  <div class="experience-modal-footer">
    <button class="modal-clear-btn" id="guestClearBtn">Clear</button>
    <button class="modal-save-btn" id="guestSaveBtn">Save</button>
  </div>
</div>

<!-- Experience Search Bar JavaScript -->
<script>
  // ExperienceSearchBar class for experience search functionality
  class ExperienceSearchBar {    constructor() {
      // Search bar elements
      this.searchContainer = document.getElementById('experienceSearchContainer');
      // Location section removed - using Place Autocomplete directly
      this.dateSection = document.getElementById('experienceDateSection');
      this.guestSection = document.getElementById('experienceGuestSection');
      this.searchButton = document.getElementById('experienceSearchButton');
      
      // Values display elements
      // Location value removed - using Place Autocomplete directly
      this.dateValue = document.getElementById('experienceDateValue');
      this.guestValue = document.getElementById('experienceGuestValue');
      
      // Modal elements
      this.modalOverlay = document.getElementById('experienceModalOverlay');
      this.locationModal = document.getElementById('experienceLocationModal');
      this.dateModal = document.getElementById('experienceDateModal');
      this.guestModal = document.getElementById('experienceGuestModal');
      
      // State variables
      this.selectedLocation = '';
      this.selectedDate = '';
      this.guests = {
        adults: 0,
        children: 0,
        infants: 0
      };
      
      // Flatpickr instance
      this.calendar = null;
    }
      init() {
      // Check if all required elements exist
      if (!this.searchContainer || !this.dateSection || 
          !this.guestSection || !this.searchButton) {
        console.warn('Experience search bar elements not found.');
        return;
      }
      
      // Initialize date format for quick options
      this.initDateOptions();
      
      // Initialize flatpickr calendar
      this.initCalendar();
      
      // Initialize Google Maps Place Autocomplete integration
      this.initPlaceAutocomplete();
      
      // Attach event listeners
      this.attachEventListeners();
      
      console.log('‚úÖ Experience Search Bar initialized');
    }
    
    initDateOptions() {
      const today = new Date();
      const tomorrow = new Date();
      tomorrow.setDate(today.getDate() + 1);
      
      // Find weekend (next Saturday)
      const weekend = new Date();
      weekend.setDate(today.getDate() + (6 - today.getDay() + 7) % 7);
      
      // Next week (7 days from now)
      const nextWeek = new Date();
      nextWeek.setDate(today.getDate() + 7);
      
      // Next month (first day of next month)
      const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
      
      // Format dates for display
      document.getElementById('todayDate').textContent = this.formatDate(today);
      document.getElementById('tomorrowDate').textContent = this.formatDate(tomorrow);
      document.getElementById('weekendDate').textContent = this.formatDate(weekend);
      document.getElementById('nextWeekDate').textContent = this.formatDate(nextWeek);
      document.getElementById('nextMonthDate').textContent = this.formatDate(nextMonth);
    }
    
    formatDate(date) {
      const options = { month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }
    
    initCalendar() {
      if (typeof flatpickr !== 'undefined') {
        this.calendar = flatpickr('#experienceCalendar', {
          inline: true,
          mode: 'single',
          dateFormat: 'Y-m-d',
          minDate: 'today',
          onChange: (selectedDates) => {
            if (selectedDates.length > 0) {
              const date = selectedDates[0];
              this.selectedDate = date;
              
              // Clear selection from quick options
              const options = document.querySelectorAll('.date-option');
              options.forEach(opt => opt.classList.remove('selected'));
            }
          }
        });
      } else {
        console.warn('Flatpickr library not loaded');
        // Add fallback date input
        document.getElementById('experienceCalendar').innerHTML = 
          '<input type="date" class="location-search-input" min="' + new Date().toISOString().split('T')[0] + '">';
      }
    }
      attachEventListeners() {
      // Open modals on section click
      // Location section removed - using Place Autocomplete directly
      this.dateSection.addEventListener('click', () => this.openModal('date'));
      this.guestSection.addEventListener('click', () => this.openModal('guest'));
      
      // Close modals
      document.getElementById('locationModalClose').addEventListener('click', () => this.closeModal('location'));
      document.getElementById('dateModalClose').addEventListener('click', () => this.closeModal('date'));
      document.getElementById('guestModalClose').addEventListener('click', () => this.closeModal('guest'));
      
      // Modal overlay click to close
      this.modalOverlay.addEventListener('click', () => this.closeAllModals());
      
      // Save buttons
      document.getElementById('locationSaveBtn').addEventListener('click', () => this.saveLocation());
      document.getElementById('dateSaveBtn').addEventListener('click', () => this.saveDate());
      document.getElementById('guestSaveBtn').addEventListener('click', () => this.saveGuests());
      
      // Clear buttons
      document.getElementById('locationClearBtn').addEventListener('click', () => this.clearLocation());
      document.getElementById('dateClearBtn').addEventListener('click', () => this.clearDate());
      document.getElementById('guestClearBtn').addEventListener('click', () => this.clearGuests());
      
      // Location search and selection
      const locationItems = document.querySelectorAll('.location-item');
      locationItems.forEach(item => {
        item.addEventListener('click', () => {
          locationItems.forEach(i => i.classList.remove('selected'));
          item.classList.add('selected');
          this.selectedLocation = item.getAttribute('data-location');
        });
      });
      
      // Location search input
      document.getElementById('locationSearchInput').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        locationItems.forEach(item => {
          const location = item.getAttribute('data-location').toLowerCase();
          const shouldShow = location.includes(searchTerm);
          item.style.display = shouldShow ? 'flex' : 'none';
        });
      });
      
      // Date quick options
      const dateOptions = document.querySelectorAll('.date-option');
      dateOptions.forEach(option => {
        option.addEventListener('click', () => {
          dateOptions.forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          
          const dateType = option.getAttribute('data-date');
          const today = new Date();
          
          switch (dateType) {
            case 'today':
              this.selectedDate = today;
              break;
            case 'tomorrow':
              const tomorrow = new Date();
              tomorrow.setDate(today.getDate() + 1);
              this.selectedDate = tomorrow;
              break;
            case 'weekend':
              const weekend = new Date();
              weekend.setDate(today.getDate() + (6 - today.getDay() + 7) % 7);
              this.selectedDate = weekend;
              break;
            case 'nextWeek':
              const nextWeek = new Date();
              nextWeek.setDate(today.getDate() + 7);
              this.selectedDate = nextWeek;
              break;
            case 'nextMonth':
              const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
              this.selectedDate = nextMonth;
              break;
            case 'flexible':
              // Just show the calendar
              break;
          }
          
          // Update calendar if needed
          if (this.calendar && dateType !== 'flexible') {
            this.calendar.setDate(this.selectedDate);
          }
        });
      });
      
      // Guest count buttons
      document.getElementById('adultIncrease').addEventListener('click', () => this.increaseCount('adult'));
      document.getElementById('adultDecrease').addEventListener('click', () => this.decreaseCount('adult'));
      document.getElementById('childIncrease').addEventListener('click', () => this.increaseCount('child'));
      document.getElementById('childDecrease').addEventListener('click', () => this.decreaseCount('child'));
      document.getElementById('infantIncrease').addEventListener('click', () => this.increaseCount('infant'));
      document.getElementById('infantDecrease').addEventListener('click', () => this.decreaseCount('infant'));
      
      // Search button
      this.searchButton.addEventListener('click', () => this.search());
    }
    
    openModal(type) {
      // Close any open modal first
      this.closeAllModals();
      
      // Show overlay
      this.modalOverlay.classList.add('visible');
      
      // Show appropriate modal
      switch (type) {
        case 'location':
          this.locationModal.classList.add('visible');
          setTimeout(() => document.getElementById('locationSearchInput').focus(), 100);
          break;
        case 'date':
          this.dateModal.classList.add('visible');
          break;
        case 'guest':
          this.guestModal.classList.add('visible');
          break;
      }
      
      // Update selected status
      // Location section removed - using Place Autocomplete directly
      this.dateSection.classList.toggle('selected', type === 'date');
      this.guestSection.classList.toggle('selected', type === 'guest');
    }
    
    closeModal(type) {
      // Hide overlay and modal
      this.modalOverlay.classList.remove('visible');
      
      switch (type) {
        case 'location':
          this.locationModal.classList.remove('visible');
          break;
        case 'date':
          this.dateModal.classList.remove('visible');
          break;
        case 'guest':
          this.guestModal.classList.remove('visible');
          break;
      }
      
      // Remove selected status
      this.dateSection.classList.remove('selected');
      this.guestSection.classList.remove('selected');
    }
    
    closeAllModals() {
      this.modalOverlay.classList.remove('visible');
      this.locationModal.classList.remove('visible');
      this.dateModal.classList.remove('visible');
      this.guestModal.classList.remove('visible');
      
      // Location section removed - using Place Autocomplete directly
      this.dateSection.classList.remove('selected');
      this.guestSection.classList.remove('selected');
    }
    
    saveLocation() {
      if (this.selectedLocation) {
        // We're now using the Google Maps Place Autocomplete directly
        // so no need to update any display value
        console.log('Selected location:', this.selectedLocation);
      }
      this.closeModal('location');
    }
    
    saveDate() {
      if (this.selectedDate) {
        const options = { month: 'short', day: 'numeric' };
        this.dateValue.textContent = this.selectedDate instanceof Date 
          ? this.selectedDate.toLocaleDateString('en-US', options)
          : new Date(this.selectedDate).toLocaleDateString('en-US', options);
        this.dateValue.classList.add('has-value');
      }
      this.closeModal('date');
    }
    
    saveGuests() {
      let guestText = [];
      const { adults, children, infants } = this.guests;
      
      if (adults > 0) {
        guestText.push(`${adults} adult${adults > 1 ? 's' : ''}`);
      }
      
      if (children > 0) {
        guestText.push(`${children} child${children > 1 ? 'ren' : ''}`);
      }
      
      if (infants > 0) {
        guestText.push(`${infants} infant${infants > 1 ? 's' : ''}`);
      }
      
      if (guestText.length > 0) {
        this.guestValue.textContent = guestText.join(', ');
        this.guestValue.classList.add('has-value');
      } else {
        this.clearGuests();
      }
      
      this.closeModal('guest');
    }
    
    clearLocation() {
      this.selectedLocation = '';
      this.locationValue.textContent = 'Search destinations';
      this.locationValue.classList.remove('has-value');
      
      // Clear selected location in list
      document.querySelectorAll('.location-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // Clear search input
      document.getElementById('locationSearchInput').value = '';
      
      // Show all location items
      document.querySelectorAll('.location-item').forEach(item => {
        item.style.display = 'flex';
      });
    }
    
    clearDate() {
      this.selectedDate = '';
      this.dateValue.textContent = 'Add dates';
      this.dateValue.classList.remove('has-value');
      
      // Clear selected date option
      document.querySelectorAll('.date-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      // Clear calendar selection if available
      if (this.calendar) {
        this.calendar.clear();
      }
    }
    
    clearGuests() {
      this.guests = {
        adults: 0,
        children: 0,
        infants: 0
      };
      
      this.guestValue.textContent = 'Add guests';
      this.guestValue.classList.remove('has-value');
      
      // Reset count displays
      document.getElementById('adultCount').textContent = '0';
      document.getElementById('childCount').textContent = '0';
      document.getElementById('infantCount').textContent = '0';
      
      // Disable decrease buttons
      document.getElementById('adultDecrease').disabled = true;
      document.getElementById('childDecrease').disabled = true;
      document.getElementById('infantDecrease').disabled = true;
    }
    
    increaseCount(type) {
      switch (type) {
        case 'adult':
          this.guests.adults++;
          document.getElementById('adultCount').textContent = this.guests.adults;
          document.getElementById('adultDecrease').disabled = this.guests.adults === 0;
          break;
        case 'child':
          this.guests.children++;
          document.getElementById('childCount').textContent = this.guests.children;
          document.getElementById('childDecrease').disabled = this.guests.children === 0;
          break;
        case 'infant':
          this.guests.infants++;
          document.getElementById('infantCount').textContent = this.guests.infants;
          document.getElementById('infantDecrease').disabled = this.guests.infants === 0;
          break;
      }
    }
    
    decreaseCount(type) {
      switch (type) {
        case 'adult':
          if (this.guests.adults > 0) {
            this.guests.adults--;
            document.getElementById('adultCount').textContent = this.guests.adults;
            document.getElementById('adultDecrease').disabled = this.guests.adults === 0;
          }
          break;
        case 'child':
          if (this.guests.children > 0) {
            this.guests.children--;
            document.getElementById('childCount').textContent = this.guests.children;
            document.getElementById('childDecrease').disabled = this.guests.children === 0;
          }
          break;
        case 'infant':
          if (this.guests.infants > 0) {
            this.guests.infants--;
            document.getElementById('infantCount').textContent = this.guests.infants;
            document.getElementById('infantDecrease').disabled = this.guests.infants === 0;
          }
          break;
      }
    }
    
    search() {
      // Get location from the place autocomplete if available
      const locationName = this.selectedLocation && this.selectedLocation.name 
        ? this.selectedLocation.name 
        : document.getElementById('from-location-exp')?.value || 'any location';
      
      // Gather all search parameters
      const searchParams = {
        location: locationName,
        date: this.selectedDate ? (this.selectedDate instanceof Date ? this.selectedDate.toISOString().split('T')[0] : this.selectedDate) : '',
        guests: this.guests
      };
      
      console.log('üîç Experience search:', searchParams);
      
      // Emit event if eventBus is available
      if (window.eventBus) {
        window.eventBus.emit('experience:search', searchParams);
      }
      
      // TODO: Implement actual search functionality or form submission
      // For now, just log the search parameters
      alert(`Searching for experiences in ${locationName} on ${searchParams.date || 'any date'} for ${this.getTotalGuests()} guests`);
    }
    
    getTotalGuests() {
      return this.guests.adults + this.guests.children + this.guests.infants || 0;
    }
  }
</script>

