<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Booking - I ❤️ Miami Concierge</title>
    <link rel="stylesheet" href="css/main.css">
    <!-- Replace this CDN link -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- With a proper production build or local file -->
<link rel="stylesheet" href="css/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom-places.css">
    <!-- Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd_O4s_73E_A8rq7TGCHKVEBFHzNecAHM&libraries=places&v=beta&loading=async"></script>

<!-- Fix the EventBus path -->
<script type="module">
  import eventBus from './src/core/EventBus.js';
  window.eventBus = eventBus;
  window.EventBus = eventBus.constructor;
  console.log('✅ EventBus loaded as module and made global');
</script>
  
  <!-- Essential functions first -->
  <script src="essential-functions.js"></script>
  
  <!-- Load your modular components -->
  <script type="module" src="dashboard.js"></script>
  <script type="module" src="simple-bridge.js"></script>
  <!-- Remove or comment out the test script -->
<!-- <script src="test-eventbus-validation.js"></script> -->

<!-- Add the validation script temporarily for final check -->
<script src="validate-eventbus-integration.js"></script>

<!-- After validation passes, remove this too -->
  </head>
  <body class="bg-gray-100" style="background-image: url('images/miami-skyline-abstract-form.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
    <header class="site-header">
  <div class="header-container">
    <!-- Logo -->
    <a href="index.html" class="site-logo">
      I ❤️ <span class="brand-gradient-text">Miami</span>
    </a>

    <!-- Mobile menu toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Navigation menu -->
    <nav class="site-nav">
      <ul class="nav-list">
        <!-- Our experiences dropdown -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" aria-expanded="false">
            Our experiences
            <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
              <path fill="currentColor" d="M7 10l5 5 5-5z"/>
            </svg>
          </button>
          <ul class="dropdown-menu">
            <li><a href="hourly.html" class="dropdown-item">Hourly Chauffeur</a></li>
            <li><a href="yacht.html" class="dropdown-item">Yacht & boat</a></li>
            <li><a href="dining.html" class="dropdown-item">Miami relocation</a></li>
            <li><a href="wynwood.html" class="dropdown-item">Tours & Excursions</a></li>
            <li><a href="airport.html" class="dropdown-item">Airport transfer</a></li>

          </ul>
        </li>

        <!-- Partner with us dropdown -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" aria-expanded="false">
            Partner with us
            <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
              <path fill="currentColor" d="M7 10l5 5 5-5z"/>
            </svg>
          </button>
          <ul class="dropdown-menu">
            <li><a href="business.html" class="dropdown-item">Yatch charters</a></li>
            <li><a href="hotels.html" class="dropdown-item">Hotels & Resorts</a></li>
            <li><a href="events.html" class="dropdown-item">Event Planners</a></li>
            <li><a href="events.html" class="dropdown-item">Something different</a></li>
          </ul>
        </li>

        <!-- Direct links -->
        <li class="nav-item">
          <a href="chauffeurs.html" class="nav-link">For chauffeurs</a>
        </li>

        <li class="nav-item">
          <a href="chat.html" class="nav-link">Chat</a>
        </li>

        <!-- Language selector -->
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" aria-expanded="false">
            English
            <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="12">
              <path fill="currentColor" d="M7 10l5 5 5-5z"/>
            </svg>
          </button>
          <ul class="dropdown-menu dropdown-menu-small">
            <li><a href="?lang=en" class="dropdown-item">English</a></li>
            <li><a href="?lang=es" class="dropdown-item">Español</a></li>
          </ul>
        </li>

        <!-- Sign in -->
        <li class="nav-item">
          <a href="login.html" class="nav-link">Sign in</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

    <main>
      <!-- Left column - Hero content -->
      <div class="hero-content">
        <h1 class="text-4xl md:text-5xl font-bold mb-6 text-white">Time is Valuable so Enjoy the moment</h1>
        <p class="text-xl text-white mb-8">Dont just see it live it.</p>
      </div>
      
      <!-- Right column - Booking form -->
      <div class="booking-form-container">
        <div class="booking-form-card">
          <div id="tab-navigation" class="border-b border-gray-200">
  <nav class="-mb-px flex w-full" aria-label="Tabs" role="tablist">
    <button type="button" id="tab-button-oneway" data-tab-target="#panel-oneway" 
            class="tab-button" 
            role="tab" aria-selected="true" aria-controls="panel-oneway">One Way</button>
    <button type="button" id="tab-button-experience-plus" data-tab-target="#panel-experience-plus" 
            class="tab-button" 
            role="tab" aria-selected="false" aria-controls="panel-experience-plus">Experience +</button>
  </nav>
</div>

          <div class="form-padding">
            
            <form action="#" method="POST" id="booking-form" class="space-y-4">
              <div class="tab-panels space-y-3 pt-2">
                <div id="panel-oneway" class="tab-panel space-y-3" role="tabpanel" tabindex="0" aria-labelledby="tab-button-oneway">
                  <!-- ONE WAY TAB: Show both From and To locations -->
                  <div id="location-fields-container-oneway" class="space-y-4">
                    <!-- From Input -->
                    <div class="relative">
                      <div class="google-maps-container">
                        <label for="from-location" class="location-label">Starting Location</label>
                        <span class="location-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                          </svg>
                        </span>
                        <gmp-place-autocomplete id="from-location" placeholder="Enter pickup location..."></gmp-place-autocomplete>
                      </div>
                      <span id="from-location-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                    </div>

                    <!-- To Input -->
                    <div class="google-maps-container">
                      <label for="to-address" class="location-label">To</label>
                      <span class="location-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12 11.5A2.5 2.5 0 0 1 9.5 9A2.5 2.5 0 0 1 12 6.5A2.5 2.5 0 0 1 14.5 9a2.5 2.5 0 0 1-2.5 2.5M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7z"></path>
                        </svg>
                      </span>
                      <gmp-place-autocomplete id="to-address"
                        address-filter="country:us"
                        type-filter="establishment,geocode,airport,lodging,point_of_interest,tourist_attraction" 
                        placeholder="Enter drop-off location"
                        required
                        aria-describedby="to-address-error">
                      </gmp-place-autocomplete>
                      <span id="to-address-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                    </div>
                  </div>

                  <div id="date-time-container-oneway" class="relative">
                    <input type="hidden" name="booking_preference" id="booking-preference" value="">
                    
                    <div class="button-container mb-4">
                      <button type="button" id="request-now-button" class="booking-time-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#1e3a8a" class="w-6 h-6">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="text-lg font-bold">Request Now</span>
                      </button>
                      <button type="button" id="book-later-button" class="booking-time-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#1e3a8a" class="w-6 h-6">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 2 00-2-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span class="text-lg font-bold">Book for Later</span>
                      </button>
                    </div>
                  </div>
                  <span id="booking-time-error" class="mt-1 block text-xs text-red-600 hidden"></span>

                  <div id="scheduled-booking-inputs" class="hidden mt-4 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-4">
                      <div>
                         <label for="pickup-date-oneway" class="block text-xs font-medium text-gray-500 mb-0.5">Date</label>
                         <input type="text" name="pickup-date-oneway" id="pickup-date-oneway" aria-describedby="pickup-date-oneway-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Date..." />
                         <span id="pickup-date-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                      </div>
                      <div>
                         <label for="pickup-time-oneway" class="block text-xs font-medium text-gray-500 mb-0.5">Time</label>
                         <input type="text" name="pickup-time-oneway" id="pickup-time-oneway" aria-describedby="pickup-time-oneway-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Time..." />
                         <span id="pickup-time-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                      </div>
                   </div>
                  </div>

                  <div id="vehicle-selection-oneway" class="vehicle-selection-container pt-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">Select Your Vehicle</h3>
                    <fieldset aria-labelledby="vehicle-selection-oneway-label" aria-describedby="vehicle-type-oneway-error">
                       <legend class="sr-only">Vehicle Selection</legend>
                       <div class="space-y-3 divide-y divide-gray-200">

                         <label for="vehicle-sedan-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                           <div class="vehicle-card-content flex items-center space-x-4 w-full">
                             <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                               <img src="images/luxury-sedan.jpg" alt="Luxury Sedan" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">Luxury Sedan</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.412 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /></svg>
                                   <span class="font-medium">3</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">2</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Tesla Model Y</p>
                               <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-green-100] text-[--color-green-800]">EV Available</span>
                               </div>
                             </div>
                           </div>

                            <input type="radio" name="vehicle_type_oneway" value="Luxury Sedan" id="vehicle-sedan-card" class="sr-only" required aria-checked="false">
                         </label>

                         <label for="vehicle-suv-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                            <div class="vehicle-card-content flex items-center space-x-4 w-full">
                              <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                                <img src="images/premium-suv-escalade.jpg" alt="Premium SUV" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">Premium SUV</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.412 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /> </svg>
                                   <span class="font-medium">6</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">5</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Cadillac Escalade</p>
                                <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-green-100] text-[--color-green-800]">EV Available</span>
                               </div>
                             </div>
                           </div>

                            <input type="radio" name="vehicle_type_oneway" value="Premium SUV" id="vehicle-suv-card" class="sr-only" required aria-checked="false">
                         </label>

                         <label for="vehicle-sprinter-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                            <div class="vehicle-card-content flex items-center space-x-4 w-full">
                              <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                                <img src="images/vip-sprinter.jpg" alt="VIP Sprinter" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">VIP Group Sprinter</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.412 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /> </svg>
                                   <span class="font-medium">14</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75A3.75 3.75 0 0012 0h-4A3.75 3.75 0 004.25 3.75v.643c.57-.078 1.14-.145 1.71-.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">14</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Mercedes Sprinter</p>
                                <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-blue-100] text-[--color-blue-800]">Mobile Lounge</span>
                               </div>
                             </div>
                           </div>

                            <input type="radio" name="vehicle_type_oneway" value="VIP Group Sprinter" id="vehicle-sprinter-card" class="sr-only" required aria-checked="false">
                         </label>

                       </div> <span id="vehicle-type-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span> </fieldset>
                  </div>
                  </div>
                <div id="panel-experience-plus" class="tab-panel space-y-3 hidden" role="tabpanel" tabindex="0" aria-labelledby="tab-button-experience-plus">
                  <!-- EXPERIENCE+ TAB: Show only Starting Location -->
                  <div id="location-fields-container-experience" class="space-y-4">
                    <!-- Starting Location Only -->
                    <div class="relative">
                      <div class="google-maps-container">
                        <label for="from-location-exp" class="location-label">Starting Location</label>
                        <span class="location-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                          </svg>
                        </span>
                        <gmp-place-autocomplete id="from-location-exp" placeholder="Enter starting location..."></gmp-place-autocomplete>
                      </div>
                      <span id="from-location-exp-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                    </div>
                  </div>

                  <!-- Experience dropdown and other experience+ fields -->
                  <div id="experience-dropdown-container" class="relative">
                    <label for="experience-dropdown" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Select Service</label>
                    <span class="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-[--color-teal]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27Z"></path></svg></span>
                    <select name="experience-dropdown" id="experience-dropdown" required aria-describedby="experience-dropdown-error" class="block w-full rounded-md border-0 py-3 pr-3 pl-12 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] focus:ring-inset sm:text-sm sm:leading-6">
                      <option value="">-- Choose Service --</option>
<option value="hourly_chauffeur">Hourly Chauffeur</option>
<option value="water_sky">Yacht & boat</option>
<option value="miami_relocation">Miami relocation</option>
<option value="tours_excursions">Tours & Excursions</option>
<option value="airport_transfer">Airport transfer</option>
                    </select>
                    <span id="experience-dropdown-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                  </div>
                  <div id="hourly-description" class="hidden text-sm text-gray-600 bg-gray-50 p-3 rounded-md border border-gray-200">
                    Ideal for business meetings, tourist visits, and multiple stop trips. Gives you flexibility and control over your schedule.
                  </div>
                  <div id="tours-description" class="hidden text-sm text-gray-600 bg-gray-50 p-3 rounded-md border border-gray-200">
  Experience Miami's vibrant culture with local expert guides. Perfect for art districts, historic sites, and hidden gems throughout the city.
</div>

<div id="airport-description" class="hidden text-sm text-gray-600 bg-gray-50 p-3 rounded-md border border-gray-200">
  Stress-free transportation to and from all Miami airports. Enjoy reliable, punctual service with flight tracking and door-to-door convenience.
</div>
                  <div id="duration-container" class="relative hidden">
                    <label for="duration-hourly" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Duration</label>
                    <span class="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-[--color-teal]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2Zm4.2 14.2L11 13V7h1.5v5.2l4.5 2.7-.8 1.3Z"></path></svg></span>
                    <select name="duration-hourly" id="duration-hourly" required aria-describedby="duration-hourly-error" class="block w-full rounded-md border-0 py-3 pr-3 pl-12 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] focus:ring-inset sm:text-sm sm:leading-6">
                      <option value="2">2 hours</option><option value="3">3 hours</option><option value="4">4 hours</option><option value="5">5 hours</option><option value="6">6 hours</option><option value="7">7 hours</option><option value="8">8 hours</option><option value="9">9 hours</option><option value="10">10 hours</option><option value="11">11 hours</option><option value="12">12 hours</option>
                    </select>
                    <span id="duration-hourly-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                  </div>
                  <div id="date-time-container-hourly" class="relative hidden">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-4">
                      <div>
                        <label for="pickup-date-hourly" class="block text-xs font-medium text-gray-500 mb-0.5">Date</label>
                        <input type="text" name="pickup-date-hourly" id="pickup-date-hourly" required aria-describedby="pickup-date-hourly-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Date..." />
                        <span id="pickup-date-hourly-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                      </div>
                      <div>
                        <label for="pickup-time-hourly" id="pickup-time-label-hourly" class="block text-xs font-medium text-gray-500 mb-0.5">Start Time</label>
                        <input type="text" name="pickup-time-hourly" id="pickup-time-hourly" required aria-describedby="pickup-time-hourly-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Start Time..." />
                        <span id="pickup-time-hourly-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                      </div>
                    </div>
                  </div>
                  <div id="date-preference-container" class="relative hidden pt-2">
                    <label class="block text-sm font-medium text-black mb-1" id="date-preference-label">Preferred Timing</label>
                    <fieldset aria-labelledby="date-preference-label" aria-describedby="date_preference-error">
                      <legend class="sr-only">Select Preferred Timing</legend>
                      <div class="flex flex-wrap gap-x-4 gap-y-2">
                        <div class="flex items-center"><input id="pref-asap" name="date_preference" type="radio" value="ASAP / Next Day" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-asap" class="ml-2 block text-sm text-gray-900">Today / Next Day</label></div>
                        <div class="flex items-center"><input id="pref-weekend" name="date_preference" type="radio" value="This Coming Weekend" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-weekend" class="ml-2 block text-sm text-gray-900">This Coming Weekend</label></div>
                        <div class="flex items-center"><input id="pref-weekday" name="date_preference" type="radio" value="Next Week (Mon-Fri)" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-weekday" class="ml-2 block text-sm text-gray-900">Next Week (Mon-Fri)</label></div>
                        <div class="flex items-center"><input id="pref-flexible" name="date_preference" type="radio" value="Flexible / Other Date" checked class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-flexible" class="ml-2 block text-sm text-gray-900">Flexible / Other Date</label></div>
                      </div>
                    </fieldset>
                    <span id="date_preference-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                  </div>
                  <div id="experience-options-container" class="hidden space-y-4">
                    <div id="water-sky-options" class="hidden relative border-t border-gray-200 pt-4"></div>
                     <div id="wynwood-night-options" class="hidden space-y-4 border-t border-gray-200 pt-4">
                       <h2 class="text-2xl font-bold text-center" style="font-family: 'Permanent Marker', cursive; color: #ff4d4d;">
                         Wynwood Art Tour
                       </h2>
                     </div>
                     <div id="miami-relocation-options" class="hidden space-y-4 border-t border-gray-200 pt-4">
  <div class="text-sm bg-gray-50 p-4 rounded-md border border-gray-200">
    <h3 class="font-bold text-lg mb-2 text-black">Housing services</h3>
    <p class="mb-3 text-black">Thinking of staying in Miami? There are options we provide our local knowledge To help you acomplish your goals. </p>
    
    
      
 
      
      
    
      

      
      <div>
        <label for="relocation-notes" class="block text-sm font-medium text-black mb-1">Brief Summary</summary></label>
        <textarea id="relocation-notes" name="relocation_notes" rows="2" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Here type when you are availabile to talk, and what you are trying to acomplish!"></textarea>
      </div>
    </div>
    
    
                    </div>
                </div>
              </div>

              <div class="form-action-buttons">
                <button type="button" id="reset-button" class="flex items-center text-gray-500 hover:text-[--color-teal] transition-colors duration-200 px-3 py-1.5 rounded-md hover:bg-gray-100">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Reset
                </button>
                <button type="submit" id="submit-button" disabled
                    class="flex items-center justify-center text-lg font-semibold"
                    title="Complete all required fields to enable submission" aria-disabled="true" aria-busy="false">
                    <span class="spinner hidden" aria-hidden="true"></span>
                    <span class="button-text">Continue</span>
                </button>
              </div>
            </form>

            <div id="confirmation-message" class="hidden text-center mt-6">
              <h3 class="font-playfair text-xl text-gray-900">Thank You!</h3>
              <p class="text-gray-600">Your request has been submitted successfully. We'll get back to you soon.</p>
            </div>
          </div>
        </div>
      </div>
    </main>    
<!-- COMMENT OUT OR REMOVE this debug section before pushing to production -->
<!--
<div style="position: fixed; top: 10px; right: 10px; background: white; padding: 10px; border: 1px solid #ccc; z-index: 9999;">
  <h4>🔧 Debug Controls</h4>
  <button onclick="forceLocationValidation('from-location', 'oneway', 'fromLocation')" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #10b981; color: white; border: none; border-radius: 4px;">
    ✅ Force From Valid
  </button>
  <button onclick="forceLocationValidation('to-address', 'oneway', 'toAddress')" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #10b981; color: white; border: none; border-radius: 4px;">
    ✅ Force To Valid
  </button>
  <button onclick="console.log('FormState:', window.formState)" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #3b82f6; color: white; border: none; border-radius: 4px;">
    🔍 Check State
  </button>
  <button onclick="document.getElementById('vehicle-selection-oneway').classList.add('show')" 
          style="display: block; margin: 5px 0; padding: 5px 10px; background: #059669; color: white; border: none; border-radius: 4px;">
    ✨ Add SHOW Class
  </button>
</div>
-->
  <!-- Enhanced Debug Controls (only visible in development) -->
<div id="debug-controls" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.9); color: white; padding: 15px; border-radius: 8px; z-index: 9998; font-family: monospace; font-size: 12px; max-width: 300px; display: none;">
  <h4 style="margin: 0 0 10px 0; color: #00ff88;">🔧 Miami Concierge Debug Panel</h4>
  
  <div style="margin-bottom: 10px;">
    <strong style="color: #00bcd4;">Form Validation:</strong>
    <button onclick="forceLocationValidation('from-location', 'oneway', 'fromLocation')" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #10b981; color: white; border: none; border-radius: 3px; font-size: 11px;">
      ✅ Force From Valid
    </button>
    <button onclick="forceLocationValidation('to-address', 'oneway', 'toAddress')" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #10b981; color: white; border: none; border-radius: 3px; font-size: 11px;">
      ✅ Force To Valid
    </button>
    <button onclick="console.log('FormState:', window.formState)" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #3b82f6; color: white; border: none; border-radius: 3px; font-size: 11px;">
      🔍 Check State
    </button>
  </div>
  
  <div style="margin-bottom: 10px;">
    <strong style="color: #ff9800;">Event Monitor:</strong>
    <button onclick="window.eventMonitor?.show()" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #9c27b0; color: white; border: none; border-radius: 3px; font-size: 11px;">
      👁️ Show Monitor
    </button>
    <button onclick="window.eventMonitor?.toggle()" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #9c27b0; color: white; border: none; border-radius: 3px; font-size: 11px;">
      🔄 Toggle Monitor
    </button>
    <button onclick="window.eventMonitor?.clear()" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #9c27b0; color: white; border: none; border-radius: 3px; font-size: 11px;">
      🧹 Clear Events
    </button>
  </div>
  
  <div style="margin-bottom: 10px;">
    <strong style="color: #f44336;">Test Events:</strong>
    <button onclick="window.eventBus?.emit('error:show', {fieldId: 'test', message: 'Test error', severity: 'error'})" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #f44336; color: white; border: none; border-radius: 3px; font-size: 11px;">
      🚨 Test Error
    </button>
    <button onclick="window.eventBus?.emit('form:submission:started', {test: true})" 
            style="display: block; margin: 3px 0; padding: 4px 8px; background: #4caf50; color: white; border: none; border-radius: 3px; font-size: 11px;">
      📝 Test Form Event
    </button>
  </div>
  
  <div style="font-size: 10px; color: #888; margin-top: 10px;">
    Ctrl+Shift+E = Toggle Monitor<br>
    Ctrl+Shift+D = Toggle Debug Panel
  </div>
</div>

<script>
// Show debug controls in development
document.addEventListener('DOMContentLoaded', () => {
  const isDevelopment = window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1' ||
                       window.location.search.includes('debug=true');
  
  if (isDevelopment) {
    const debugPanel = document.getElementById('debug-controls');
    if (debugPanel) {
      debugPanel.style.display = 'block';
      
      // Add keyboard shortcut to toggle debug panel (Ctrl+Shift+D)
      document.addEventListener('keydown', (event) => {
        if (event.ctrlKey && event.shiftKey && event.key === 'D') {
          event.preventDefault();
          debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
        }
      });
    }
  }
});
</script>
<!-- Load core modules first -->
<script type="module" src="./core/EventBus.js"></script>
<script type="module" src="./core/EventDefinitions.js"></script>
<script type="module" src="./core/DOMManager.js"></script>
<script type="module" src="./core/ComponentRegistry.js"></script>

<!-- Load enhanced components -->
<script type="module" src="./dashboard-components.js"></script>

<!-- Initialize event monitoring -->
<script type="module">
  import { initEventMonitor } from './event-monitor.js';
  
  document.addEventListener('DOMContentLoaded', () => {
    if (window.location.hostname === 'localhost' || window.location.search.includes('debug=true')) {
      initEventMonitor();
    }
  });
</script>
<script type="module">
  // Import centralized event definitions
  import EventDefinitions from './core/EventDefinitions.js';
  
  // Make available globally
  window.MiamiEvents = EventDefinitions;
  
  // Update existing event emitters to use centralized definitions
  function updateFormSubmission() {
    // OLD: eventBus.emit('form:submission:started', data);
    // NEW:
    eventBus.emit(EventDefinitions.EVENTS.FORM.SUBMISSION_STARTED, 
      EventDefinitions.createFormPayload(data, 'submission'));
  }
  
  function updateErrorHandling() {
    // OLD: eventBus.emit('error:show', {fieldId: 'email', message: 'Invalid email'});
    // NEW:
    eventBus.emit(EventDefinitions.EVENTS.ERROR.SHOW, 
      EventDefinitions.createFieldError('email', 'Invalid email'));
  }
  
  function updateLocationSelection() {
    // OLD: eventBus.emit('map:location:selected', locationData);
    // NEW:
    eventBus.emit(EventDefinitions.EVENTS.MAP.LOCATION_SELECTED, 
      EventDefinitions.createLocationPayload(locationData));
  }
  
  function updateAnalyticsTracking() {
    // OLD: eventBus.emit('analytics:track', {event: 'form_submitted'});
    // NEW:
    eventBus.emit(EventDefinitions.EVENTS.ANALYTICS.TRACK, 
      EventDefinitions.createAnalyticsPayload('form_submitted'));
  }
  
  // Update event listeners to use centralized definitions
  function setupEventListeners() {
    // Form events
    eventBus.on(EventDefinitions.EVENTS.FORM.FIELD_CHANGED, handleFieldChange);
    eventBus.on(EventDefinitions.EVENTS.FORM.SUBMISSION_STARTED, handleSubmissionStart);
    eventBus.on(EventDefinitions.EVENTS.FORM.SUBMISSION_SUCCEEDED, handleSubmissionSuccess);
    
    // Error events
    eventBus.on(EventDefinitions.EVENTS.ERROR.SHOW, handleErrorShow);
    eventBus.on(EventDefinitions.EVENTS.ERROR.CLEAR, handleErrorClear);
    
    // Map events
    eventBus.on(EventDefinitions.EVENTS.MAP.LOCATION_SELECTED, handleLocationSelected);
    eventBus.on(EventDefinitions.EVENTS.LOCATION.VALIDATION_REQUIRED, handleLocationValidation);
    
    // Analytics events
    eventBus.on(EventDefinitions.EVENTS.ANALYTICS.TRACK, handleAnalyticsTrack);
  }
  
  // Initialize with centralized events
  document.addEventListener('DOMContentLoaded', () => {
    setupEventListeners();
    
    // Log available events for debugging
    console.log('🎯 Miami Concierge Events Loaded:', EventDefinitions.getAllEvents().length);
    
    // Emit system ready event
    eventBus.emit(EventDefinitions.EVENTS.SYSTEM.READY, {
      timestamp: Date.now(),
      version: '1.0.0',
      eventCount: EventDefinitions.getAllEvents().length
    });
  });
</script>
<!-- Add missing event handlers before the existing script -->
<script type="module">
  import EventDefinitions from './core/EventDefinitions.js';
  
  // Define missing event handler functions
  function handleFieldChange(data) {
    console.log('📝 Field changed:', data);
    
    // Update UI based on field changes
    if (data.fieldId && data.newValue !== undefined) {
      // Trigger validation if needed
      if (window.validateField) {
        window.validateField(data.fieldId, data.newValue);
      }
    }
  }
  
  function handleSubmissionStart(data) {
    console.log('🚀 Form submission started:', data);
    
    // Show loading state
    const submitButton = document.getElementById('submit-button');
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.setAttribute('aria-busy', 'true');
      
      // Add spinner
      const spinner = submitButton.querySelector('.spinner');
      if (spinner) {
        spinner.classList.remove('hidden');
      }
      
      // Update button text
      const buttonText = submitButton.querySelector('.button-text');
      if (buttonText) {
        buttonText.textContent = 'Processing...';
      }
    }
  }
  
  function handleSubmissionSuccess(data) {
    console.log('✅ Form submission succeeded:', data);
    
    // Hide form and show confirmation
    const form = document.getElementById('booking-form');
    const confirmation = document.getElementById('confirmation-message');
    
    if (form) form.style.display = 'none';
    if (confirmation) {
      confirmation.classList.remove('hidden');
      confirmation.classList.add('block');
    }
    
    // Reset submit button
    const submitButton = document.getElementById('submit-button');
    if (submitButton) {
      submitButton.disabled = false;
      submitButton.setAttribute('aria-busy', 'false');
      
      const spinner = submitButton.querySelector('.spinner');
      if (spinner) spinner.classList.add('hidden');
      
      const buttonText = submitButton.querySelector('.button-text');
      if (buttonText) buttonText.textContent = 'Continue';
    }
  }
  
  function handleErrorShow(data) {
    console.log('🚨 Error shown:', data);
    
    // Use error handling module if available
    if (window.errorHandling && window.errorHandling.showError) {
      const elements = window.elementRefs || {};
      window.errorHandling.showError(elements, data.fieldId, data.message);
    } else {
      // Fallback error display
      const errorElement = document.getElementById(`${data.fieldId}-error`);
      if (errorElement) {
        errorElement.textContent = data.message;
        errorElement.classList.remove('hidden');
      }
    }
  }
  
  function handleErrorClear(data) {
    console.log('✨ Error cleared:', data);
    
    // Use error handling module if available
    if (window.errorHandling && window.errorHandling.clearError) {
      window.errorHandling.clearError(data.fieldId);
    } else {
      // Fallback error clearing
      const errorElement = document.getElementById(`${data.fieldId}-error`);
      if (errorElement) {
        errorElement.textContent = '';
        errorElement.classList.add('hidden');
      }
    }
  }
  
  function handleLocationSelected(data) {
    console.log('📍 Location selected:', data);
    
    // Update form state if needed
    if (window.formState && data.fieldId) {
      const tab = data.tab || 'oneway';
      const fieldKey = data.fieldId.includes('from') ? 'fromLocation' : 'toAddress';
      
      if (window.formState[tab]) {
        window.formState[tab][fieldKey] = true;
      }
    }
    
    // Trigger validation
    if (window.validateFormState) {
      window.validateFormState();
    }
  }
  
  function handleLocationValidation(data) {
    console.log('🔍 Location validation required:', data);
    
    // Trigger location validation logic
    if (data.fieldId && window.validateLocationField) {
      window.validateLocationField(data.fieldId);
    }
  }
  
  function handleAnalyticsTrack(data) {
    console.log('📊 Analytics track:', data);
    
    // Send to analytics service
    if (window.gtag) {
      window.gtag('event', data.event, {
        event_category: data.category || 'form',
        event_label: data.label,
        value: data.value,
        custom_map: data.properties
      });
    }
    
    // Also log for debugging
    if (window.location.hostname === 'localhost') {
      console.log('📊 Analytics Event:', data);
    }
  }
  
  // Make handlers available globally
  window.handleFieldChange = handleFieldChange;
  window.handleSubmissionStart = handleSubmissionStart;
  window.handleSubmissionSuccess = handleSubmissionSuccess;
  window.handleErrorShow = handleErrorShow;
  window.handleErrorClear = handleErrorClear;
  window.handleLocationSelected = handleLocationSelected;
  window.handleLocationValidation = handleLocationValidation;
  window.handleAnalyticsTrack = handleAnalyticsTrack;
  
  // Update event listeners setup function
  function setupEventListeners() {
    console.log('🎯 Setting up Miami Concierge event listeners...');
    
    // Check if EventBus is available
    if (!window.eventBus) {
      console.warn('⚠️ EventBus not available, skipping event listener setup');
      return;
    }
    
    try {
      // Form events
      eventBus.on(EventDefinitions.EVENTS.FORM.FIELD_CHANGED, handleFieldChange);
      eventBus.on(EventDefinitions.EVENTS.FORM.SUBMISSION_STARTED, handleSubmissionStart);
      eventBus.on(EventDefinitions.EVENTS.FORM.SUBMISSION_SUCCEEDED, handleSubmissionSuccess);
      
      // Error events
      eventBus.on(EventDefinitions.EVENTS.ERROR.SHOW, handleErrorShow);
      eventBus.on(EventDefinitions.EVENTS.ERROR.CLEAR, handleErrorClear);
      
      // Map events
      eventBus.on(EventDefinitions.EVENTS.MAP.LOCATION_SELECTED, handleLocationSelected);
      eventBus.on(EventDefinitions.EVENTS.LOCATION.VALIDATION_REQUIRED, handleLocationValidation);
      
      // Analytics events
      eventBus.on(EventDefinitions.EVENTS.ANALYTICS.TRACK, handleAnalyticsTrack);
      
      console.log('✅ Event listeners set up successfully');
      
    } catch (error) {
      console.error('❌ Error setting up event listeners:', error);
    }
  }
  
  // Update initialization
  document.addEventListener('DOMContentLoaded', () => {
    setupEventListeners();
    
    // Log available events for debugging
    if (EventDefinitions.getAllEvents) {
      console.log('🎯 Miami Concierge Events Loaded:', EventDefinitions.getAllEvents().length);
    }
    
    // Emit system ready event
    if (window.eventBus) {
      eventBus.emit(EventDefinitions.EVENTS.SYSTEM.READY, {
        timestamp: Date.now(),
        version: '1.0.0',
        handlers: [
          'handleFieldChange',
          'handleSubmissionStart', 
          'handleSubmissionSuccess',
          'handleErrorShow',
          'handleErrorClear',
          'handleLocationSelected',
          'handleLocationValidation',
          'handleAnalyticsTrack'
        ]
      });
    }
  });
</script>
  </body>
</html>


