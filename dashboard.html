<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Booking - I ❤️ Miami Concierge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <style>
      /* Root variables including new ones for cards */
      :root {
        --color-gold: #B08D57;
        --color-gold-dark: #9A7B4F;
        --color-teal: #00A09A;
        --color-teal-dark: #00807A;
        --color-teal-50: #E6F5F4;      /* Light teal for selected card/button background */
        --color-teal-light-bg: #f0fdfa;
        --color-palm-green: #3CB371;
        --color-green-100: #D1FAE5;    /* Tailwind green-100 */
        --color-green-800: #065F46;    /* Tailwind green-800 */
        --color-blue-100: #DBEAFE;     /* Tailwind blue-100 */
        --color-blue-800: #1E40AF;     /* Tailwind blue-800 */
      }
      body { font-family: 'Inter', sans-serif; color: #1f2937; }
      h1, h2, h3, .font-playfair { font-family: 'Playfair Display', serif; }
      .brand-gradient-text { background: linear-gradient(to right, #f97316, #ef4444); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 700; }
      select { appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="%2300A09A" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em; padding-right: 2.5rem; }

      /* Tab styles */
      .tab-button.active-tab#tab-button-oneway { background-color: white; color: var(--color-teal); border-left-color: #e5e7eb; border-right-color: #e5e7eb; border-top-color: #e5e7eb; border-bottom-color: transparent; font-weight: 600; }
      .tab-button:not(.active-tab)#tab-button-oneway { background-color: #f9fafb; color: #6b7280; border-color: transparent; }
      .tab-button:not(.active-tab)#tab-button-oneway:hover { background-color: #f3f4f6; color: #4b5563; }
      .tab-button.active-tab#tab-button-experience-plus { background-color: #FFC107; color: #1A237E; border-left-color: #FFC107; border-right-color: #FFC107; border-top-color: #FFC107; border-bottom-color: transparent; font-weight: 600; }
      .tab-button:not(.active-tab)#tab-button-experience-plus { background-color: #FFF8E1; color: #FFB300; border-color: transparent; }
      .tab-button:not(.active-tab)#tab-button-experience-plus:hover { background-color: #FFECB3; color: #FFA000; }

      /* Flatpickr styles */
      .flatpickr-calendar { background: white; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }

      /* Screen reader only */
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

      /* Vehicle Card Styles */
      .vehicle-card:has(input:checked) { border-color: var(--color-teal); box-shadow: 0 0 0 2px var(--color-teal); background-color: var(--color-teal-50); }
      .vehicle-card:hover { border-color: #9ca3af; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1); }

      /* NEW: Booking Time Button Styles */
      .booking-time-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1rem; /* p-3 p-4 */
        border: 1px solid #d1d5db; /* border-gray-300 */
        border-radius: 0.375rem; /* rounded-md */
        background-color: white;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
        font-size: 0.875rem; /* text-sm */
        font-weight: 500; /* font-medium */
        color: #374151; /* text-gray-700 */
      }
      .booking-time-button:hover {
        border-color: #9ca3af; /* hover:border-gray-400 */
      }
      .booking-time-button svg {
        margin-right: 0.5rem; /* mr-2 */
        width: 1.1rem; /* ~h-4/w-4 */
        height: 1.1rem;
        fill: currentColor; /* Icon color matches text */
      }
      .booking-time-button.active {
         border-color: var(--color-teal);
         background-color: var(--color-teal-50);
         color: var(--color-teal-dark);
         font-weight: 600; /* font-semibold */
         box-shadow: 0 0 0 1px var(--color-teal); /* Ring effect */
      }

      /* Mobile Responsiveness for Cards */
      @media (max-width: 400px) {
        .vehicle-card { flex-direction: column; align-items: center; }
        .vehicle-card-content { flex-direction: column; align-items: center; text-align: center; width: 100%; }
        .vehicle-card-details { margin-left: 0; margin-top: 0.75rem; width: 100%; align-items: center; }
        .vehicle-card-details .flex { justify-content: center; }
        .badge-container { justify-content: center; margin-top: 0.25rem; }
        .vehicle-image-container { width: 100%; max-width: 10rem; }
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <header class="bg-white border-b border-gray-200">
      <nav class="container mx-auto flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8">
        <div><a href="index.html" class="text-3xl font-bold text-gray-900"> I ❤️ <span class="brand-gradient-text">Miami</span> </a></div>
        <div><span class="mr-4 text-gray-600">Welcome, [Name]!</span><a href="#" class="text-sm font-medium text-[--color-gold] hover:text-[--color-gold-dark]">Logout</a></div>
      </nav>
    </header>

    <main class="container mx-auto px-4 py-8 sm:px-6 lg:px-8">
      <div class="mr-auto w-full max-w-lg">
        <div class="overflow-hidden rounded-xl bg-white shadow-md">
          <div id="tab-navigation" class="border-b border-gray-200">
            <nav class="-mb-px flex" aria-label="Tabs" role="tablist">
              <button type="button" id="tab-button-oneway" data-tab-target="#panel-oneway" class="tab-button w-1/2 whitespace-nowrap py-4 px-1 border-t border-l border-r border-b-2 text-sm text-center rounded-tl-xl" role="tab" aria-selected="true" aria-controls="panel-oneway">One Way</button>
              <button type="button" id="tab-button-experience-plus" data-tab-target="#panel-experience-plus" class="tab-button w-1/2 whitespace-nowrap py-4 px-1 border-t border-l border-r border-b-2 text-sm text-center rounded-tr-xl" role="tab" aria-selected="false" aria-controls="panel-experience-plus">Experience +</button>
            </nav>
          </div>

          <div class="p-6 md:p-8">
            <form action="#" method="POST" id="booking-form" class="space-y-3">
              <div class="relative">
                <label for="from-location" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">From</label>
                <span class="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-[--color-teal]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 11.5A2.5 2.5 0 0 1 9.5 9A2.5 2.5 0 0 1 12 6.5A2.5 2.5 0 0 1 14.5 9a2.5 2.5 0 0 1-2.5 2.5M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Z"></path></svg></span>
                <input type="text" name="from-location" id="from-location" required aria-describedby="from-location-error" class="block w-full rounded-md border-0 py-3 pr-3 pl-12 text-gray-900 ring-1 ring-gray-300 ring-inset placeholder:text-gray-400 focus:ring-2 focus:ring-[--color-gold] focus:ring-inset sm:text-sm sm:leading-6" placeholder="Address, airport, hotel, ..." />
                <span id="from-location-error" class="mt-1 block text-xs text-red-600 hidden"></span>
              </div>

              <div class="tab-panels space-y-3 pt-2">
                <div id="panel-oneway" class="tab-panel space-y-3" role="tabpanel" tabindex="0" aria-labelledby="tab-button-oneway">
                  <div id="to-address-container" class="relative">
                    <label for="to-address" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">To</label>
                    <span class="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-[--color-teal]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 11.5A2.5 2.5 0 0 1 9.5 9A2.5 2.5 0 0 1 12 6.5A2.5 2.5 0 0 1 14.5 9a2.5 2.5 0 0 1-2.5 2.5M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Z"></path></svg></span>
                    <input type="text" name="to-address" id="to-address" aria-describedby="to-address-error" class="block w-full rounded-md border-0 py-3 pr-3 pl-12 text-gray-900 ring-1 ring-gray-300 ring-inset placeholder:text-gray-400 focus:ring-2 focus:ring-[--color-gold] focus:ring-inset sm:text-sm sm:leading-6" placeholder="Address, airport, hotel, ..." />
                    <span id="to-address-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                  </div>

                  <div id="date-time-container-oneway" class="relative">
                    <input type="hidden" name="booking_preference" id="booking-preference" value=""> <label class="block text-xs font-medium text-gray-500 mb-1">Pickup Time</label>
                     <div class="grid grid-cols-2 gap-x-3" aria-labelledby="booking-time-error">
                         <button type="button" id="request-now-button" class="booking-time-button">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                               <path d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0 0 10 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393Z" />
                            </svg>
                             Request now
                         </button>
                         <button type="button" id="book-later-button" class="booking-time-button">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-13a.75.75 0 0 0-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 0 0 0-1.5h-3.25V5Z" clip-rule="evenodd" />
                            </svg>
                            Book for later
                         </button>
                     </div>
                     <span id="booking-time-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                  </div>

                  <div id="scheduled-booking-inputs" class="hidden mt-4 space-y-4">
                      <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-4">
                        <div>
                           <label for="pickup-date-oneway" class="block text-xs font-medium text-gray-500 mb-0.5">Date</label>
                           <input type="text" name="pickup-date-oneway" id="pickup-date-oneway" aria-describedby="pickup-date-oneway-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Date..." />
                           <span id="pickup-date-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                        </div>
                        <div>
                           <label for="pickup-time-oneway" class="block text-xs font-medium text-gray-500 mb-0.5">Time</label>
                           <input type="text" name="pickup-time-oneway" id="pickup-time-oneway" aria-describedby="pickup-time-oneway-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Time..." />
                           <span id="pickup-time-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                        </div>
                     </div>
                  </div>
                  <div id="vehicle-selection-oneway" class="pt-4">
                    <h4 class="text-sm font-semibold text-gray-700 mb-3 font-playfair" id="vehicle-selection-oneway-label">Choose Your Luxury Ride</h4>
                    <fieldset aria-labelledby="vehicle-selection-oneway-label" aria-describedby="vehicle-type-oneway-error">
                       <legend class="sr-only">Vehicle Selection</legend>
                       <div class="space-y-3 divide-y divide-gray-200">

                         <label for="vehicle-sedan-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                           <div class="vehicle-card-content flex items-center space-x-4 w-full">
                             <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                               <img src="images/luxury-sedan.jpg" alt="Luxury Sedan" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">Luxury Sedan</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /></svg>
                                   <span class="font-medium">3</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75A3.75 3.75 0 0012 0h-4A3.75 3.75 0 004.25 3.75v.643c.57-.078 1.14-.145 1.71-.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /></svg>
                                    <span class="font-medium">2</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Tesla Model Y</p>
                               <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-green-100] text-[--color-green-800]">EV Available</span>
                               </div>
                             </div>
                           </div>
                           
                            <input type="radio" name="vehicle_type_oneway" value="Luxury Sedan" id="vehicle-sedan-card" class="sr-only" required aria-checked="false">
                         </label>

                         <label for="vehicle-suv-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                            <div class="vehicle-card-content flex items-center space-x-4 w-full">
                              <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                                <img src="images/premium-suv-escalade.jpg" alt="Premium SUV" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">Premium SUV</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /> </svg>
                                   <span class="font-medium">6</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75A3.75 3.75 0 0012 0h-4A3.75 3.75 0 004.25 3.75v.643c.57-.078 1.14-.145 1.71-.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">5</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Cadillac Escalade</p>
                                <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-green-100] text-[--color-green-800]">EV Available</span>
                               </div>
                             </div>
                           </div>
                           
                            <input type="radio" name="vehicle_type_oneway" value="Premium SUV" id="vehicle-suv-card" class="sr-only" required aria-checked="false">
                         </label>

                         <label for="vehicle-sprinter-card" class="vehicle-card pt-3 flex items-center justify-between rounded-lg border border-transparent bg-white px-2 sm:px-3 py-3 sm:py-4 shadow-sm cursor-pointer transition duration-150 ease-in-out focus-within:ring-2 focus-within:ring-[--color-teal]">
                            <div class="vehicle-card-content flex items-center space-x-4 w-full">
                              <div class="vehicle-image-container flex-shrink-0 w-28 aspect-[4/3] overflow-hidden rounded-md">
                                <img src="images/vip-sprinter.jpg" alt="VIP Sprinter" class="w-full h-full object-cover">
                             </div>
                             <div class="vehicle-card-details">
                               <p class="text-base font-medium text-gray-900">VIP Group Sprinter</p>
                               <div class="flex items-center space-x-3 text-xs text-gray-500 mt-1">
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.41-1.412A9.978 9.978 0 0010 12c-2.31 0-4.438.784-6.131 2.1-.194.51-.02.979.406 1.393z" /> </svg>
                                   <span class="font-medium">14</span>
                                 </span>
                                 <span class="flex items-center">
                                   <svg class="w-3.5 h-3.5 mr-1 text-[--color-teal]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 018.75 1h2.5A2.75 2.75 0 0114 3.75v.443c.57.055 1.14.122 1.71.2V3.75A3.75 3.75 0 0012 0h-4A3.75 3.75 0 004.25 3.75v.643c.57-.078 1.14-.145 1.71-.2V3.75zM4.75 5.11v9.14a.75.75 0 00.75.75h9a.75.75 0 00.75-.75v-9.14c-.61-.087-1.2-.19-1.75-.315V6.5a.75.75 0 00-1.5 0v-.194c-1.06-.214-2.14-.214-3.2 0V6.5a.75.75 0 00-1.5 0v-.409c-.55.125-1.14.228-1.75.315zM5.5 6.6v8.15h9V6.6a18.225 18.225 0 01-4.5 0c-1.06.214-2.14.214-3.2 0a18.225 18.225 0 01-1.3 0z" clip-rule="evenodd" /> </svg>
                                   <span class="font-medium">10+</span>
                                 </span>
                               </div>
                               <p class="text-xs text-gray-500 mt-1">e.g., Mercedes Sprinter</p>
                                <div class="badge-container flex flex-wrap gap-2 mt-1.5">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[--color-blue-100] text-[--color-blue-800]">Mobile Lounge</span>
                               </div>
                             </div>
                           </div>
                           
                            <input type="radio" name="vehicle_type_oneway" value="VIP Group Sprinter" id="vehicle-sprinter-card" class="sr-only" required aria-checked="false">
                         </label>

                       </div> <span id="vehicle-type-oneway-error" class="mt-1 block text-xs text-red-600 hidden"></span> </fieldset>
                  </div>
                  </div>
                <div id="panel-experience-plus" class="tab-panel space-y-3 hidden" role="tabpanel" tabindex="0" aria-labelledby="tab-button-experience-plus">
                   <div id="experience-dropdown-container" class="relative">
                     <label for="experience-dropdown" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Select Service</label>
                     <span class="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-[--color-teal]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27Z"></path></svg></span>
                     <select name="experience-dropdown" id="experience-dropdown" required aria-describedby="experience-dropdown-error" class="block w-full rounded-md border-0 py-3 pr-3 pl-12 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] focus:ring-inset sm:text-sm sm:leading-6">
                       <option value="">-- Choose Service --</option>
                       <option value="hourly_chauffeur">Hourly Chauffeur</option>
                       <option value="water_sky">Ultimate Miami Water & Sky</option>
                       <option value="wynwood_night">Wynwood Art & Culinary Night</option>
                       <option value="everglades">Everglades Adventure</option>
                       <option value="keys_escape">Keys Escape Experience</option>
                     </select>
                     <span id="experience-dropdown-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                   </div>
                   <div id="hourly-description" class="hidden text-sm text-gray-600 bg-gray-50 p-3 rounded-md border border-gray-200">
                     Ideal for business meetings, tourist visits, and multiple stop trips. Gives you flexibility and control over your schedule.
                   </div>
                   <div id="duration-container" class="relative hidden">
                     <label for="duration-hourly" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Duration</label>
                     <span class="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-[--color-teal]"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2Zm4.2 14.2L11 13V7h1.5v5.2l4.5 2.7-.8 1.3Z"></path></svg></span>
                     <select name="duration-hourly" id="duration-hourly" required aria-describedby="duration-hourly-error" class="block w-full rounded-md border-0 py-3 pr-3 pl-12 text-gray-900 ring-1 ring-gray-300 focus:ring-2 focus:ring-[--color-gold] focus:ring-inset sm:text-sm sm:leading-6">
                       <option value="2">2 hours</option><option value="3">3 hours</option><option value="4">4 hours</option><option value="5">5 hours</option><option value="6">6 hours</option><option value="7">7 hours</option><option value="8">8 hours</option><option value="9">9 hours</option><option value="10">10 hours</option><option value="11">11 hours</option><option value="12">12 hours</option>
                     </select>
                     <span id="duration-hourly-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                   </div>
                   <div id="date-time-container-hourly" class="relative hidden">
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-4">
                       <div>
                         <label for="pickup-date-hourly" class="block text-xs font-medium text-gray-500 mb-0.5">Date</label>
                         <input type="text" name="pickup-date-hourly" id="pickup-date-hourly" required aria-describedby="pickup-date-hourly-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Date..." />
                         <span id="pickup-date-hourly-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                       </div>
                       <div>
                         <label for="pickup-time-hourly" id="pickup-time-label-hourly" class="block text-xs font-medium text-gray-500 mb-0.5">Start Time</label>
                         <input type="text" name="pickup-time-hourly" id="pickup-time-hourly" required aria-describedby="pickup-time-hourly-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="Select Start Time..." />
                         <span id="pickup-time-hourly-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                       </div>
                     </div>
                   </div>
                   <div id="date-preference-container" class="relative hidden pt-2">
                     <label class="block text-sm font-medium text-gray-700 mb-1" id="date-preference-label">Preferred Timing</label>
                     <fieldset aria-labelledby="date-preference-label" aria-describedby="date_preference-error">
                       <legend class="sr-only">Select Preferred Timing</legend>
                       <div class="flex flex-wrap gap-x-4 gap-y-2">
                         <div class="flex items-center"><input id="pref-asap" name="date_preference" type="radio" value="ASAP / Next Day" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-asap" class="ml-2 block text-sm text-gray-900">ASAP / Next Day</label></div>
                         <div class="flex items-center"><input id="pref-weekend" name="date_preference" type="radio" value="This Coming Weekend" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-weekend" class="ml-2 block text-sm text-gray-900">This Coming Weekend</label></div>
                         <div class="flex items-center"><input id="pref-weekday" name="date_preference" type="radio" value="Next Week (Mon-Fri)" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-weekday" class="ml-2 block text-sm text-gray-900">Next Week (Mon-Fri)</label></div>
                         <div class="flex items-center"><input id="pref-flexible" name="date_preference" type="radio" value="Flexible / Other Date" checked class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]"><label for="pref-flexible" class="ml-2 block text-sm text-gray-900">Flexible / Other Date</label></div>
                       </div>
                     </fieldset>
                     <span id="date_preference-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                   </div>
                   <div id="common-experience-fields" class="hidden space-y-4 border-t border-gray-200 pt-4">
                     <h5 class="text-sm font-semibold text-gray-700">Your Contact Details & Guests</h5>
                     <div class="grid grid-cols-1 gap-x-4 gap-y-5 sm:grid-cols-2">
                       <div class="relative">
                         <label for="experience-name" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Your Name</label>
                         <input type="text" name="name" id="experience-name" required aria-describedby="experience-name-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" />
                         <span id="experience-name-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                       </div>
                       <div class="relative">
                         <label for="experience-guests" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Number of Guests</label>
                         <input type="number" name="guests" id="experience-guests" required min="1" value="2" aria-describedby="experience-guests-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" />
                         <span id="experience-guests-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                       </div>
                       <div class="relative">
                         <label for="experience-email" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Email</label>
                         <input type="email" name="email" id="experience-email" required aria-describedby="experience-email-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" />
                         <span id="experience-email-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                       </div>
                       <div class="relative">
                         <label for="experience-phone" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Phone</label>
                         <input type="tel" name="phone" id="experience-phone" required aria-describedby="experience-phone-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" />
                         <span id="experience-phone-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                       </div>
                     </div>
                   </div>
                   <div id="experience-options-container" class="hidden space-y-4">
                     <div id="water-sky-options" class="hidden relative border-t border-gray-200 pt-4"></div>
                      <div id="wynwood-night-options" class="hidden space-y-4 border-t border-gray-200 pt-4">
                       <div class="space-y-4">
                         <div>
                           <label class="mb-2 block text-sm font-medium text-gray-900" id="motivation-label">What's the occasion for this experience?</label>
                           <fieldset aria-labelledby="motivation-label" aria-describedby="motivation-error">
                             <legend class="sr-only">Select Occasion</legend>
                             <div class="grid grid-cols-2 gap-3 sm:grid-cols-4">
                               <label for="motivation-romantic" class="flex cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white p-3 text-sm font-medium text-gray-700 hover:bg-gray-50 has-[:checked]:border-[--color-teal] has-[:checked]:ring-1 has-[:checked]:ring-[--color-teal]">
                                 <input type="radio" name="motivation" value="Romantic" id="motivation-romantic" class="sr-only">
                                 <span class="flex items-center"><span class="mr-1.5 text-lg">❤️</span> Romantic</span>
                               </label>
                               <label for="motivation-celebration" class="flex cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white p-3 text-sm font-medium text-gray-700 hover:bg-gray-50 has-[:checked]:border-[--color-teal] has-[:checked]:ring-1 has-[:checked]:ring-[--color-teal]">
                                 <input type="radio" name="motivation" value="Birthday/Celebration" id="motivation-celebration" class="sr-only">
                                 <span class="flex items-center"><span class="mr-1.5 text-lg">🎉</span> Celebration</span>
                               </label>
                               <label for="motivation-business" class="flex cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white p-3 text-sm font-medium text-gray-700 hover:bg-gray-50 has-[:checked]:border-[--color-teal] has-[:checked]:ring-1 has-[:checked]:ring-[--color-teal]">
                                 <input type="radio" name="motivation" value="Business/Corporate" id="motivation-business" class="sr-only">
                                 <span class="flex items-center"><span class="mr-1.5 text-lg">💼</span> Business</span>
                               </label>
                               <label for="motivation-fun" class="flex cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white p-3 text-sm font-medium text-gray-700 hover:bg-gray-50 has-[:checked]:border-[--color-teal] has-[:checked]:ring-1 has-[:checked]:ring-[--color-teal]">
                                 <input type="radio" name="motivation" value="Friends Night Out / Fun" id="motivation-fun" class="sr-only">
                                 <span class="flex items-center"><span class="mr-1.5 text-lg">🥳</span> Fun / Friends</span>
                               </label>
                             </div>
                           </fieldset>
                           <span id="motivation-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                         </div>
                       </div>
                       <div class="space-y-4 pt-4 border-t border-gray-200">
                         <h5 class="text-sm font-semibold text-gray-700" id="dinner-preference-label">Dinner Preferences</h5>
                         <div>
                           <fieldset class="mt-1" aria-labelledby="dinner-preference-label" aria-describedby="dinner_style_preference-error">
                             <legend class="sr-only">Dinner Style Preference</legend>
                             <div class="flex flex-wrap gap-x-4 gap-y-2">
                               <div class="flex items-center"><input id="wynwood-dinner-vibrant" name="dinner_style_preference" type="radio" value="Vibrant Scene & Global Flavors" checked class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-dinner-vibrant" class="ml-2 block text-sm text-gray-900">Vibrant Scene & Global Flavors</label></div>
                               <div class="flex items-center"><input id="wynwood-dinner-steak" name="dinner_style_preference" type="radio" value="Upscale Steakhouse" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-dinner-steak" class="ml-2 block text-sm text-gray-900">Upscale Steakhouse</label></div>
                               <div class="flex items-center"><input id="wynwood-dinner-modern" name="dinner_style_preference" type="radio" value="Modern American / European" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-dinner-modern" class="ml-2 block text-sm text-gray-900">Modern American / European</label></div>
                               <div class="flex items-center"><input id="wynwood-dinner-italian" name="dinner_style_preference" type="radio" value="Elevated Italian / Mediterranean" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-dinner-italian" class="ml-2 block text-sm text-gray-900">Elevated Italian / Mediterranean</label></div>
                               <div class="flex items-center"><input id="wynwood-dinner-seafood" name="dinner_style_preference" type="radio" value="Iconic Miami Seafood" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-dinner-seafood" class="ml-2 block text-sm text-gray-900">Iconic Miami Seafood</label></div>
                               <div class="flex items-center"><input id="wynwood-dinner-other-style" name="dinner_style_preference" type="radio" value="Other" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-dinner-other-style" class="ml-2 block text-sm text-gray-900">Other (Specify)</label></div>
                             </div>
                           </fieldset>
                           <span id="dinner_style_preference-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                         </div>
                         <div id="wynwood-other-restaurant-container" class="relative hidden">
                            <label for="wynwood-other-restaurant" class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-500">Other Cuisine / Restaurant Request</label>
                            <input type="text" name="other_restaurant_request" id="wynwood-other-restaurant" aria-describedby="wynwood-other-restaurant-error" class="block w-full rounded-md border-0 py-3 px-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-[--color-gold] sm:text-sm" placeholder="e.g., Italian, specific restaurant name" />
                            <span id="wynwood-other-restaurant-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                         </div>
                       </div>
                       <div class="space-y-1 pt-4 border-t border-gray-200">
                         <h5 class="text-sm font-semibold text-gray-700" id="lounge-interest-label">Post-Dinner Lounge/Bar</h5>
                         <div>
                           <fieldset class="mt-1" aria-labelledby="lounge-interest-label" aria-describedby="lounge_interest-error">
                             <legend class="sr-only">Post-Dinner Option</legend>
                             <div class="flex flex-wrap gap-3">
                               <div class="flex items-center"><input id="wynwood-lounge-yes" name="lounge_interest" type="radio" value="Yes" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-lounge-yes" class="ml-2 block text-sm text-gray-900">Yes</label></div>
                               <div class="flex items-center"><input id="wynwood-lounge-no" name="lounge_interest" type="radio" value="No" checked class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-lounge-no" class="ml-2 block text-sm text-gray-900">No</label></div>
                               <div class="flex items-center"><input id="wynwood-lounge-maybe" name="lounge_interest" type="radio" value="Maybe - Discuss" class="h-4 w-4 border-gray-300 text-[--color-teal] focus:ring-[--color-teal]" /><label for="wynwood-lounge-maybe" class="ml-2 block text-sm text-gray-900">Maybe (Discuss)</label></div>
                             </div>
                           </fieldset>
                           <span id="lounge_interest-error" class="mt-1 block text-xs text-red-600 hidden"></span>
                         </div>
                       </div>
                      </div>
                      <div id="everglades-options" class="hidden relative border-t border-gray-200 pt-4"></div>
                      <div id="keys-escape-options" class="hidden relative border-t border-gray-200 pt-4"></div>
                    </div>
                </div>
              </div>

              <div>
                <button type="submit" id="submit-button" class="mt-4 flex w-full items-center justify-center rounded-lg border border-transparent bg-[--color-gold] px-4 py-3 text-lg font-semibold text-white shadow-sm transition duration-300 hover:bg-[--color-gold-dark] focus:ring-2 focus:ring-[--color-gold] focus:ring-offset-2 focus:outline-none disabled:opacity-75">
                  <span class="spinner hidden mr-2">
                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                  </span>
                  <span class="button-text">Continue</span>
                </button>
                <span id="submit-button-error" class="mt-1 block text-xs text-red-600 hidden"></span>
              </div>
            </form>

            <div id="confirmation-message" class="hidden text-center mt-6">
              <h3 class="font-playfair text-xl text-gray-900">Thank You!</h3>
              <p class="text-gray-600">Your request has been submitted successfully. We'll get back to you soon.</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- Configuration ---
        const config = {
          FORM_ENDPOINT: "https://formspree.io/your-endpoint", // Replace with your actual endpoint
          MAX_NOTES_LENGTH: 500,
          placeholders: {
            // Optional notes placeholders if you add a notes field back
          }
        };

        // --- Element References ---
         function getElementRefs() {
          const refs = {};
          refs.bookingForm = document.getElementById('booking-form');
          refs.tabNavigationContainer = document.getElementById('tab-navigation');
          refs.tabNavigationButtons = refs.tabNavigationContainer?.querySelectorAll('.tab-button');
          refs.formTabPanels = refs.bookingForm?.querySelectorAll('.tab-panel');
          refs.fromLocationInput = document.getElementById('from-location');

          // One Way Panel specific
          refs.oneWayPanel = document.getElementById('panel-oneway');
          refs.toAddressInput = document.getElementById('to-address');
          refs.requestNowButton = document.getElementById('request-now-button'); // NEW
          refs.bookLaterButton = document.getElementById('book-later-button'); // NEW
          refs.scheduledBookingInputsContainer = document.getElementById('scheduled-booking-inputs'); // NEW
          refs.bookingPreferenceInput = document.getElementById('booking-preference'); // NEW
          refs.oneWayPickupDateInput = document.getElementById('pickup-date-oneway'); // Still needed, now inside hidden container
          refs.oneWayPickupTimeInput = document.getElementById('pickup-time-oneway'); // Still needed, now inside hidden container
          refs.vehicleSelectionOneway = document.getElementById('vehicle-selection-oneway');

          // Experience+ Panel specific
          refs.experiencePlusPanel = document.getElementById('panel-experience-plus');
          refs.serviceDropdown = document.getElementById('experience-dropdown');
          refs.hourlyDescription = document.getElementById('hourly-description');
          refs.durationContainer = document.getElementById('duration-container');
          refs.durationSelect = document.getElementById('duration-hourly');
          refs.hourlyDateTimeContainer = document.getElementById('date-time-container-hourly');
          refs.hourlyPickupDateInput = document.getElementById('pickup-date-hourly');
          refs.hourlyPickupTimeInput = document.getElementById('pickup-time-hourly');
          refs.hourlyPickupTimeLabel = document.getElementById('pickup-time-label-hourly');
          refs.datePreferenceContainer = document.getElementById('date-preference-container');
          refs.experienceOptionsContainer = document.getElementById('experience-options-container');
          refs.commonExperienceFieldsContainer = document.getElementById('common-experience-fields');
          refs.experienceNameInput = document.getElementById('experience-name');
          refs.experienceGuestsInput = document.getElementById('experience-guests');
          refs.experienceEmailInput = document.getElementById('experience-email');
          refs.experiencePhoneInput = document.getElementById('experience-phone');
          refs.wynwoodNightOptions = document.getElementById('wynwood-night-options');
          refs.wynwoodDinnerPrefRadios = document.querySelectorAll('#wynwood-night-options input[name="dinner_style_preference"]');
          refs.wynwoodOtherRestaurantContainer = document.getElementById('wynwood-other-restaurant-container');
          refs.wynwoodOtherDinnerRadio = document.getElementById('wynwood-dinner-other-style');
          refs.waterSkyOptions = document.getElementById('water-sky-options');
          refs.evergladesOptions = document.getElementById('everglades-options');
          refs.keysEscapeOptions = document.getElementById('keys-escape-options');

          // Common Form Elements
          document.getElementById('submit-button').querySelector('.button-text').textContent = 'Continue';
          refs.submitButtonText = refs.submitButton?.querySelector('.button-text');
          refs.submitButtonSpinner = refs.submitButton?.querySelector('.spinner');
          refs.confirmationMessage = document.getElementById('confirmation-message');

          // Store Flatpickr instances (NEW)
          refs.flatpickrInstances = {};

          return refs;
        }


        // --- Initialize Flatpickr ---
         function initializeFlatpickr(elements) {
          if (!flatpickr) { console.error("Flatpickr library not loaded."); return; }
          const commonDateConfig = { altInput: true, altFormat: "D, M j, Y", dateFormat: "Y-m-d", enableTime: false, minDate: "today" };
          const commonTimeConfig = { enableTime: true, noCalendar: true, dateFormat: "H:i", altInput: true, altFormat: "h : i K", time_24hr: false, minuteIncrement: 10 };

          // Initialize Hourly Pickers immediately
          if (elements.hourlyPickupDateInput) {
              elements.flatpickrInstances.hourlyDate = flatpickr(elements.hourlyPickupDateInput, commonDateConfig);
          }
          if (elements.hourlyPickupTimeInput) {
              elements.flatpickrInstances.hourlyTime = flatpickr(elements.hourlyPickupTimeInput, commonTimeConfig);
          }

          // One-Way pickers will be initialized on demand when 'Book for later' is clicked
          console.log("Flatpickr initialized for hourly inputs. One-way deferred.");
        }

        // --- Helper Functions ---
         function showError(elements, fieldId, message) {
          const errorSpanId = `${fieldId}-error`;
          const errorSpan = document.getElementById(errorSpanId);
          const inputElement = document.getElementById(fieldId); // Might be null for radio/button groups
          let labelText = fieldId;

          // Specific handling for button group validation message
          if (fieldId === 'booking-time') {
               labelText = 'Pickup Time Choice';
               const bookingTimeErrorSpan = document.getElementById('booking-time-error');
               if (bookingTimeErrorSpan) {
                   bookingTimeErrorSpan.textContent = message; // Use the direct message here
                   bookingTimeErrorSpan.classList.remove('hidden');
               }
               // Optionally add error styling to buttons or container
               elements.requestNowButton?.classList.add('border-red-500');
               elements.bookLaterButton?.classList.add('border-red-500');
               return; // Exit
           }

          // Special handling for radio button group validation message
          if (fieldId === 'vehicle_type_oneway') {
             labelText = 'Vehicle Type';
             const fieldset = document.querySelector('#vehicle-selection-oneway fieldset');
             const fieldsetErrorSpan = fieldset ? fieldset.querySelector('#vehicle-type-oneway-error') : null;
             if (fieldsetErrorSpan) {
                 fieldsetErrorSpan.textContent = message; // Use the direct message here
                 fieldsetErrorSpan.classList.remove('hidden');
             }
             if (fieldset) {
                 fieldset.classList.add('ring-red-500', 'ring-1', 'rounded-md', 'p-1'); // Add styling to fieldset
             }
             return; // Exit
          }

          // Existing label logic
          const labelElement = document.querySelector(`label[for="${fieldId}"]`) || document.getElementById(`${fieldId}-label`);
          if (labelElement) { labelText = labelElement.textContent.replace('*', '').trim(); }
          else if (fieldId === 'date_preference') labelText = 'Preferred Timing';
          else if (fieldId === 'motivation') labelText = 'Occasion';
          else if (fieldId === 'dinner_style_preference') labelText = 'Dinner Preference';
          else if (fieldId === 'lounge_interest') labelText = 'Lounge Interest';
          else if (fieldId === 'wynwood-other-restaurant') labelText = 'Other Cuisine / Restaurant Request';
          // Add labels for new/moved one-way inputs if needed
          else if (fieldId === 'pickup-date-oneway') labelText = 'Date';
          else if (fieldId === 'pickup-time-oneway') labelText = 'Time';


          const fullMessage = `${labelText}: ${message}`;

          if (errorSpan) {
            errorSpan.textContent = fullMessage;
            errorSpan.classList.remove('hidden');
          } else { console.warn(`Error span not found for ID: ${errorSpanId}`); }

          // Apply styling to input/select/textarea
          if (inputElement && ['INPUT', 'SELECT', 'TEXTAREA'].includes(inputElement.tagName)) {
            inputElement.classList.add('ring-red-500', 'ring-1');
            inputElement.setAttribute('aria-invalid', 'true');
            let describedBy = inputElement.getAttribute('aria-describedby') || '';
            if (!describedBy.includes(errorSpanId)) {
                 inputElement.setAttribute('aria-describedby', describedBy ? `${describedBy} ${errorSpanId}` : errorSpanId);
            }
          }
        }

         function clearError(fieldId) {
          const errorSpanId = `${fieldId}-error`;
          const errorSpan = document.getElementById(errorSpanId);
          const inputElement = document.getElementById(fieldId); // Might be null

           // Specific handling for button group error
           if (fieldId === 'booking-time') {
               const bookingTimeErrorSpan = document.getElementById('booking-time-error');
               if (bookingTimeErrorSpan) {
                   bookingTimeErrorSpan.textContent = '';
                   bookingTimeErrorSpan.classList.add('hidden');
               }
               elementRefs.requestNowButton?.classList.remove('border-red-500');
               elementRefs.bookLaterButton?.classList.remove('border-red-500');
               return; // Exit
           }

          // Special handling for radio button group error
          if (fieldId === 'vehicle_type_oneway') {
              const fieldset = document.querySelector('#vehicle-selection-oneway fieldset');
              const fieldsetErrorSpan = fieldset ? fieldset.querySelector('#vehicle-type-oneway-error') : null;
              if (fieldsetErrorSpan) {
                  fieldsetErrorSpan.textContent = '';
                  fieldsetErrorSpan.classList.add('hidden');
              }
              if (fieldset) {
                  fieldset.classList.remove('ring-red-500', 'ring-1', 'rounded-md', 'p-1'); // Remove styling from fieldset
              }
              return; // Exit
          }

          // Existing logic
          if (errorSpan) { errorSpan.textContent = ''; errorSpan.classList.add('hidden'); }

          if (inputElement && ['INPUT', 'SELECT', 'TEXTAREA'].includes(inputElement.tagName)) {
            inputElement.classList.remove('ring-red-500', 'ring-1');
            inputElement.removeAttribute('aria-invalid');
            let describedBy = inputElement.getAttribute('aria-describedby');
            if (describedBy) {
                describedBy = describedBy.replace(errorSpanId, '').trim();
                if (describedBy) {
                    inputElement.setAttribute('aria-describedby', describedBy);
                } else {
                    inputElement.removeAttribute('aria-describedby');
                }
            }
          }
        }

         function clearAllErrors(elements) {
          const errorSpans = elements.bookingForm?.querySelectorAll('[id$="-error"]');
          errorSpans?.forEach(span => { span.textContent = ''; span.classList.add('hidden'); });
          const errorInputs = elements.bookingForm?.querySelectorAll('.ring-red-500, .border-red-500');
          errorInputs?.forEach(el => el.classList.remove('ring-red-500', 'ring-1', 'rounded-md', 'p-1', 'border-red-500')); // Include button/fieldset removal
          elements.bookingForm?.querySelectorAll('[aria-invalid="true"]').forEach(el => el.removeAttribute('aria-invalid'));
          elements.bookingForm?.querySelectorAll('fieldset[aria-describedby]').forEach(el => el.removeAttribute('aria-describedby'));
          clearError('submit-button');
          clearError('vehicle_type_oneway');
          clearError('booking-time'); // NEW: Clear booking time button error
        }

        // (determineButtonText, resetSubmitButton, setLoadingButton, handleWynwoodDinnerChoice remain the same as before)
        function determineButtonText(elements) {
            let activePanelId = '';
            const activeTabButton = elements.tabNavigationContainer?.querySelector('.active-tab');
            activePanelId = activeTabButton ? activeTabButton.getAttribute('data-tab-target') : null;
            const selectedService = elements.serviceDropdown?.value || '';
            if (activePanelId === '#panel-oneway') return 'Get Quote';
            else if (activePanelId === '#panel-experience-plus') {
              if (selectedService === 'hourly_chauffeur') return 'Request Hourly Service';
              else if (selectedService !== '') return 'Request Experience';
              else return 'Select Service';
            }
            return 'Submit';
        }

        function resetSubmitButton(elements) {
            if (!elements.submitButton) return;
            elements.submitButton.disabled = false;
            if (elements.submitButtonSpinner) elements.submitButtonSpinner.classList.add('hidden');
            if (elements.submitButtonText) {
              elements.submitButtonText.textContent = determineButtonText(elements);
              elements.submitButtonText.classList.remove('hidden');
            }
        }

        function setLoadingButton(elements) {
            if (!elements.submitButton) return;
            elements.submitButton.disabled = true;
            if (elements.submitButtonText) elements.submitButtonText.classList.add('hidden');
            if (elements.submitButtonSpinner) elements.submitButtonSpinner.classList.remove('hidden');
        }

        function handleWynwoodDinnerChoice(elements) {
            if (!elements.wynwoodOtherDinnerRadio || !elements.wynwoodOtherRestaurantContainer) return;
            const showOtherInput = elements.wynwoodOtherDinnerRadio.checked;
            elements.wynwoodOtherRestaurantContainer.classList.toggle('hidden', !showOtherInput);
            const otherInput = elements.wynwoodOtherRestaurantContainer.querySelector('input');
              if (otherInput) {
                  otherInput.required = showOtherInput;
                  if (!showOtherInput) {
                      otherInput.value = '';
                      clearError('wynwood-other-restaurant');
                  }
              }
        }


        // --- UI Update Functions ---
         function updateExperiencePlusPanelUI(elements, placeholders) {
            console.log("updateExperiencePlusPanelUI called");
            console.log("Experience Plus Panel:", elements.experiencePlusPanel);
            console.log("Service Dropdown:", elements.serviceDropdown);

            if (!elements.experiencePlusPanel || !elements.serviceDropdown) {
                console.warn("Experience Plus Panel or Service Dropdown is missing.");
                return;
            }

            const selectedValue = elements.serviceDropdown.value;
            console.log("Selected Service Value:", selectedValue);

            const showHourly = selectedValue === "hourly_chauffeur";
            const showCuratedExperience = selectedValue !== "" && !showHourly;

            console.log("Show Hourly:", showHourly);
            console.log("Show Curated Experience:", showCuratedExperience);

            elements.hourlyDescription?.classList.toggle("hidden", !showHourly);
            elements.durationContainer?.classList.toggle("hidden", !showHourly);
            elements.hourlyDateTimeContainer?.classList.toggle("hidden", !showHourly);
            elements.datePreferenceContainer?.classList.toggle("hidden", !showCuratedExperience);
            elements.commonExperienceFieldsContainer?.classList.toggle("hidden", !showCuratedExperience);
            elements.experienceOptionsContainer?.classList.toggle("hidden", !showCuratedExperience);

            if (elements.hourlyPickupTimeLabel) {
                elements.hourlyPickupTimeLabel.textContent = "Start Time";
            }

            const allExperienceOptionDivs = [
                elements.wynwoodNightOptions,
                elements.waterSkyOptions,
                elements.evergladesOptions,
                elements.keysEscapeOptions
            ];

            allExperienceOptionDivs.forEach(el => el?.classList.add("hidden"));

            if (showCuratedExperience && elements.experienceOptionsContainer) {
                if (selectedValue === "wynwood_night" && elements.wynwoodNightOptions) {
                    console.log("Displaying Wynwood Night Options");
                    elements.wynwoodNightOptions.classList.remove("hidden");
                    handleWynwoodDinnerChoice(elements);
                } else if (selectedValue === "water_sky" && elements.waterSkyOptions) {
                    console.log("Displaying Water Sky Options");
                    elements.waterSkyOptions.classList.remove("hidden");
                } else if (selectedValue === "everglades" && elements.evergladesOptions) {
                    console.log("Displaying Everglades Options");
                    elements.evergladesOptions.classList.remove("hidden");
                } else if (selectedValue === "keys_escape" && elements.keysEscapeOptions) {
                    console.log("Displaying Keys Escape Options");
                    elements.keysEscapeOptions.classList.remove("hidden");
                }
            } else {
                if (elements.wynwoodOtherRestaurantContainer) {
                    elements.wynwoodOtherRestaurantContainer.classList.add("hidden");
                    const otherInput = elements.wynwoodOtherRestaurantContainer.querySelector("input");
                    if (otherInput) {
                        otherInput.value = "";
                        clearError("wynwood-other-restaurant");
                    }
                }
            }

            resetSubmitButton(elements);
            clearAllErrors(elements);
        }

         function switchTab(targetPanelId, elements, placeholders) {
            console.log("Switching to tab:", targetPanelId);

            elements.formTabPanels?.forEach(panel => panel.classList.add("hidden"));
            elements.tabNavigationButtons?.forEach(button => {
                button.classList.remove("active-tab");
                button.setAttribute("aria-selected", "false");
                button.removeAttribute("tabindex");
            });

            const targetPanel = document.querySelector(targetPanelId);
            const targetButton = elements.tabNavigationContainer?.querySelector(`[data-tab-target="${targetPanelId}"]`);
            let firstFocusableElement = null;

            if (targetPanel) {
                targetPanel.classList.remove("hidden");
                firstFocusableElement = targetPanel.querySelector("input:not([type=\"hidden\"]):not(.sr-only):not(:disabled), select:not(:disabled), textarea:not(:disabled), button:not([disabled])");
            }
            if (targetButton) {
                targetButton.classList.add("active-tab");
                targetButton.setAttribute("aria-selected", "true");
                targetButton.setAttribute("tabindex", "0");
            }

            const oneWayElements = [elements.toAddressInput?.closest(".relative"), elements.oneWayPickupDateInput?.closest(".grid"), elements.vehicleSelectionOneway];
            const expPlusElements = [elements.serviceDropdown?.closest(".relative"), elements.hourlyDescription, elements.durationContainer, elements.hourlyDateTimeContainer, elements.datePreferenceContainer, elements.commonExperienceFieldsContainer, elements.experienceOptionsContainer];

            console.log("One Way Elements:", oneWayElements);
            console.log("Experience Plus Elements:", expPlusElements);

            if (targetPanelId === "#panel-oneway") {
                oneWayElements.forEach(el => el?.classList.remove("hidden"));
                expPlusElements.forEach(el => el?.classList.add("hidden"));
                if (elements.serviceDropdown) elements.serviceDropdown.value = "";
                updateExperiencePlusPanelUI(elements, placeholders);
            } else if (targetPanelId === "#panel-experience-plus") {
                oneWayElements.forEach(el => el?.classList.add("hidden"));
                expPlusElements.forEach(el => el?.classList.remove("hidden"));
                updateExperiencePlusPanelUI(elements, placeholders);
                const oneWayRadios = document.querySelectorAll("input[name=\"vehicle_type_oneway\"]");
                oneWayRadios.forEach(radio => radio.checked = false);
                const vehicleCardRadios = document.querySelectorAll(".vehicle-card input[type=\"radio\"][name=\"vehicle_type_oneway\"]");
                vehicleCardRadios.forEach(r => r.setAttribute("aria-checked", "false"));
                document.querySelectorAll(".vehicle-card").forEach(card => {
                    // Reset styles - relies on CSS :has(:checked) or requires adding/removing a JS class
                    // card.classList.remove("selected-card-style"); // Example if using JS class
                });
                firstFocusableElement = elements.serviceDropdown || firstFocusableElement;
            }

            setTimeout(() => {
                if (firstFocusableElement) {
                    firstFocusableElement.focus();
                }
            }, 50);

            resetSubmitButton(elements);
            clearAllErrors(elements);
        }


        // --- Form Validation ---
         function validateForm(elements) {
          let isValid = true;
          const activeTabButton = elements.tabNavigationContainer?.querySelector('.active-tab');
          const activePanelId = activeTabButton ? activeTabButton.getAttribute('data-tab-target') : null;

          clearAllErrors(elements); // Start fresh

          // Always validate 'From' location
          if (!elements.fromLocationInput?.value.trim()) {
            showError(elements, 'from-location', 'Please enter a "From" location.');
            isValid = false;
          }

          if (activePanelId === '#panel-oneway') {
            // Validate 'To' address
            if (!elements.toAddressInput?.value.trim()) {
                showError(elements, 'to-address', 'Please enter a "To" address.');
                isValid = false;
            }

            // Validate Time Preference (NEW)
            const bookingPref = elements.bookingPreferenceInput?.value;
            if (!bookingPref) {
                showError(elements, 'booking-time', 'Please select "Request now" or "Book for later".');
                isValid = false;
            } else if (bookingPref === 'Scheduled') {
                // Validate Date/Time only if 'Book for later' is chosen
                if (!elements.oneWayPickupDateInput?.value) {
                    showError(elements, 'pickup-date-oneway', 'Please select a date.');
                    isValid = false;
                }
                if (!elements.oneWayPickupTimeInput?.value) {
                    showError(elements, 'pickup-time-oneway', 'Please select a time.');
                    isValid = false;
                }
            } // No date/time validation needed if 'ASAP'

            // Validate Vehicle Selection
            const vehicleSelectedOneway = document.querySelector('input[name="vehicle_type_oneway"]:checked');
            if (!vehicleSelectedOneway) {
                showError(elements, 'vehicle_type_oneway', 'Please select a vehicle type.');
                isValid = false;
            }

          } else if (activePanelId === '#panel-experience-plus') {
            // Experience+ validation remains the same as before
             const selectedService = elements.serviceDropdown.value;
             if (!selectedService) {
               showError(elements, 'experience-dropdown', 'Please select a Service.');
               isValid = false;
             } else if (selectedService === 'hourly_chauffeur') {
               if (!elements.durationSelect?.value) { showError(elements, 'duration-hourly', 'Please select duration.'); isValid = false; }
               if (!elements.hourlyPickupDateInput?.value) { showError(elements, 'pickup-date-hourly', 'Please select a date.'); isValid = false; }
               if (!elements.hourlyPickupTimeInput?.value) { showError(elements, 'pickup-time-hourly', 'Please select a start time.'); isValid = false; }
             } else { // Curated Experience selected
               if (!elements.experienceNameInput?.value.trim()) { showError(elements, 'experience-name', 'Name required.'); isValid = false; }
               if (!elements.experienceGuestsInput?.value || parseInt(elements.experienceGuestsInput.value, 10) < 1) { showError(elements, 'experience-guests', 'Min 1 guest.'); isValid = false; }
               if (!elements.experienceEmailInput?.value.trim()) {
                  showError(elements, 'experience-email', 'Email required.'); isValid = false;
               } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(elements.experienceEmailInput.value.trim())) {
                  showError(elements, 'experience-email', 'Invalid email format.'); isValid = false;
               }
               if (!elements.experiencePhoneInput?.value.trim()) {
                   showError(elements, 'experience-phone', 'Phone required.');
                   isValid = false;
               } else if (!/^\+?[\d\s()-]{10,20}$/.test(elements.experiencePhoneInput.value) || !/[\d]{10}/.test(elements.experiencePhoneInput.value.replace(/\D/g, ''))) {
                 showError(elements, 'experience-phone', 'Invalid phone format (minimum 10 digits).');
                 isValid = false;
               }
               const datePrefSelected = document.querySelector('input[name="date_preference"]:checked');
               if (!datePrefSelected) { showError(elements, 'date_preference', 'Please select timing preference.'); isValid = false; }

               // Wynwood specific validation
               if (selectedService === 'wynwood_night') {
                 const motivationSelected = document.querySelector('#wynwood-night-options input[name="motivation"]:checked');
                 const dinnerPrefSelected = document.querySelector('#wynwood-night-options input[name="dinner_style_preference"]:checked');
                 const loungeSelected = document.querySelector('#wynwood-night-options input[name="lounge_interest"]:checked');
                 if (!motivationSelected) { showError(elements, 'motivation', 'Occasion required.'); isValid = false; }
                 if (!dinnerPrefSelected) { showError(elements, 'dinner_style_preference', 'Dinner preference required.'); isValid = false; }
                   if (elements.wynwoodOtherDinnerRadio?.checked) {
                       const otherRestaurantInput = document.getElementById('wynwood-other-restaurant');
                       if (!otherRestaurantInput?.value.trim()) {
                           showError(elements, 'wynwood-other-restaurant', 'Please specify other preference.');
                           isValid = false;
                       }
                   }
                 if (!loungeSelected) { showError(elements, 'lounge_interest', 'Lounge interest required.'); isValid = false; }
               }
               // Add validation for other experiences if options are added
             }
          } else {
            isValid = false;
            console.error("No active tab panel identified for validation.");
          }

          return isValid;
        }


        // --- Form Data Processing ---
         function processFormData(elements) {
          const formData = new FormData(elements.bookingForm);
          let serviceType = '';
          const activeTabButton = elements.tabNavigationContainer?.querySelector('.active-tab');
          const activePanelId = activeTabButton ? activeTabButton.getAttribute('data-tab-target') : null;

          const dataObject = {
            'from-location': formData.get('from-location')?.trim(),
          };

          if (activePanelId === '#panel-oneway') {
            serviceType = 'One Way';
            dataObject.service_type = serviceType;
            dataObject['to-address'] = formData.get('to-address')?.trim();
            dataObject.vehicle_type = formData.get('vehicle_type_oneway'); // Get selected vehicle card

            // Add booking preference and conditional date/time (NEW)
            dataObject.booking_preference = formData.get('booking_preference'); // 'ASAP' or 'Scheduled'
            if (dataObject.booking_preference === 'Scheduled') {
                 dataObject['pickup-date'] = formData.get('pickup-date-oneway');
                 dataObject['pickup-time'] = formData.get('pickup-time-oneway');
            }

          } else if (activePanelId === '#panel-experience-plus') {
            // Experience+ processing remains the same
             const selectedServiceValue = elements.serviceDropdown.value;
             if (selectedServiceValue === 'hourly_chauffeur') {
               serviceType = 'Hourly';
               dataObject.service_type = serviceType;
               dataObject.experience_name = "Hourly Chauffeur"; // Keep consistent naming
               dataObject['duration-hourly'] = formData.get('duration-hourly');
               dataObject['pickup-date'] = formData.get('pickup-date-hourly');
               dataObject['pickup-time'] = formData.get('pickup-time-hourly');
             } else if (selectedServiceValue) {
               serviceType = 'Experience';
               dataObject.service_type = serviceType;
               dataObject.experience_name = elements.serviceDropdown.options[elements.serviceDropdown.selectedIndex].text;
               dataObject.date_preference = formData.get('date_preference');
               dataObject.name = formData.get('name')?.trim();
               dataObject.guests = formData.get('guests');
               dataObject.email = formData.get('email')?.trim();
               dataObject.phone = formData.get('phone')?.trim();

               if (selectedServiceValue === 'wynwood_night') {
                 dataObject.motivation = formData.get('motivation');
                 dataObject.dinner_style_preference = formData.get('dinner_style_preference');
                 if (formData.get('dinner_style_preference') === 'Other') {
                   dataObject.other_restaurant_request = formData.get('other_restaurant_request')?.trim();
                 }
                 dataObject.lounge_interest = formData.get('lounge_interest');
               }
               // Add data processing for other experiences if options are added
             }
          }

          // Clean up potential undefined/null/empty string values
          Object.keys(dataObject).forEach(key => {
               if (dataObject[key] === null || dataObject[key] === undefined || dataObject[key] === '') {
                   // Special case: keep other_restaurant_request only if dinner style is 'Other'
                   if (key === 'other_restaurant_request' && dataObject.dinner_style_preference !== 'Other') {
                       delete dataObject[key];
                   } else if (key !== 'other_restaurant_request') { // Delete other empty fields
                       delete dataObject[key];
                   }
               }
          });


          console.log("Final Data Object for Submission:", dataObject);
          return dataObject;
        }

        // --- Form Submission ---
         function sendFormData(dataObject, elements, config) {
          // This function remains the same - handles sending data to Formspree
          setLoadingButton(elements);
          clearError('submit-button');

           if (!config.FORM_ENDPOINT || config.FORM_ENDPOINT === "https://formspree.io/your-endpoint" || config.FORM_ENDPOINT === "YOUR_FORMSPREE_ENDPOINT") {
             setTimeout(() => {
               console.warn("Formspree endpoint not configured. Data logged to console.");
               alert("DEV MODE: Form endpoint not set. Data logged to console.\n\n" + JSON.stringify(dataObject, null, 2));
               resetSubmitButton(elements);
             }, 1000);
             return;
           }

          fetch(config.FORM_ENDPOINT, {
            method: 'POST',
            body: JSON.stringify(dataObject),
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' }
          }).then(response => {
            if (response.ok) {
              const formContentContainer = elements.bookingForm.closest('.p-6');
              const tabNav = elements.tabNavigationContainer;
              if (formContentContainer) formContentContainer.classList.add('hidden');
              if (tabNav) tabNav.classList.add('hidden');
              if (elements.confirmationMessage) elements.confirmationMessage.classList.remove('hidden');
                 elements.confirmationMessage.scrollIntoView({ behavior: 'smooth' });
            } else {
              response.json().then(data => {
                 const errorMessage = data?.errors?.map(err => err.message).join(', ') || data?.error || 'Could not submit request. Please check details and try again.';
                 showError(elements, 'submit-button', `Submission Error: ${errorMessage}`);
                 resetSubmitButton(elements);
               }).catch(() => {
                 showError(elements, 'submit-button', `Submission Error: Server returned status ${response.status}. Please try again.`);
                 resetSubmitButton(elements);
               });
            }
          }).catch(error => {
            console.error('Network error:', error);
            showError(elements, 'submit-button', 'Network Error: Could not connect. Please check your internet connection and try again.');
            resetSubmitButton(elements);
          });
        }

        // --- Event Listener Setup ---
         function initializeEventListeners(elements, placeholders, config) {
           // Tab switching
           elements.tabNavigationContainer?.addEventListener('click', (event) => {
               const button = event.target.closest('.tab-button');
               if (button && button.dataset.tabTarget && !button.classList.contains('active-tab')) {
                   switchTab(button.dataset.tabTarget, elements, placeholders);
               }
           });

           // Experience+ dropdown change
           elements.serviceDropdown?.addEventListener('change', () => updateExperiencePlusPanelUI(elements, placeholders));

           // NEW: One Way Time Preference Button Clicks
           elements.requestNowButton?.addEventListener('click', () => {
               clearError('booking-time');
               elements.requestNowButton.classList.add('active');
               elements.bookLaterButton?.classList.remove('active');
               elements.scheduledBookingInputsContainer?.classList.add('hidden');
               elements.bookingPreferenceInput.value = 'ASAP';
               // Clear scheduled inputs and destroy flatpickr instances if they exist
               if (elements.oneWayPickupDateInput) elements.oneWayPickupDateInput.value = '';
               if (elements.oneWayPickupTimeInput) elements.oneWayPickupTimeInput.value = '';
               if (elements.flatpickrInstances.oneWayDate) { elements.flatpickrInstances.oneWayDate.destroy(); delete elements.flatpickrInstances.oneWayDate; }
               if (elements.flatpickrInstances.oneWayTime) { elements.flatpickrInstances.oneWayTime.destroy(); delete elements.flatpickrInstances.oneWayTime; }
               clearError('pickup-date-oneway');
               clearError('pickup-time-oneway');
           });

           elements.bookLaterButton?.addEventListener('click', () => {
               clearError('booking-time');
               elements.bookLaterButton.classList.add('active');
               elements.requestNowButton?.classList.remove('active');
               elements.scheduledBookingInputsContainer?.classList.remove('hidden');
               elements.bookingPreferenceInput.value = 'Scheduled';

               // Initialize Flatpickr for one-way inputs if not already done
               if (!elements.flatpickrInstances.oneWayDate && elements.oneWayPickupDateInput) {
                   const commonDateConfig = { altInput: true, altFormat: "D, M j, Y", dateFormat: "Y-m-d", enableTime: false, minDate: "today" };
                   elements.flatpickrInstances.oneWayDate = flatpickr(elements.oneWayPickupDateInput, commonDateConfig);
               }
               if (!elements.flatpickrInstances.oneWayTime && elements.oneWayPickupTimeInput) {
                    const commonTimeConfig = { enableTime: true, noCalendar: true, dateFormat: "H:i", altInput: true, altFormat: "h : i K", time_24hr: false, minuteIncrement: 10 };
                   elements.flatpickrInstances.oneWayTime = flatpickr(elements.oneWayPickupTimeInput, commonTimeConfig);
               }
               // Focus the date input after revealing
               setTimeout(() => elements.oneWayPickupDateInput?.focus(), 50);
           });


           // Add listeners to regular inputs/selects to clear errors on input/change
           elements.bookingForm?.querySelectorAll('input:not([type="radio"]):not([type="button"]), select, textarea').forEach(input => {
               let targetId = input.id || input.name;
               if (!targetId) return;
               // Clear specific errors (date/time) when they get input
               if (targetId === 'pickup-date-oneway' || targetId === 'pickup-time-oneway') {
                   input.addEventListener('change', () => clearError(targetId)); // Use change for flatpickr
               } else {
                   const eventType = (input.tagName === 'INPUT' && !['number', 'email', 'tel', 'date', 'time'].includes(input.type)) ? 'input' : 'change';
                   input.addEventListener(eventType, () => clearError(targetId));
                   input.addEventListener('blur', () => clearError(targetId)); // Clear on blur too
               }
           });

           // Add listeners to specific radio groups (excluding vehicle_type_oneway)
           ['dinner_style_preference', 'motivation', 'lounge_interest', 'date_preference'].forEach(name => {
               document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
                   radio.addEventListener('change', () => {
                       clearError(name); // Clear error for the group
                       if (name === 'dinner_style_preference' && elements.wynwoodNightOptions && !elements.wynwoodNightOptions.classList.contains('hidden')) {
                           handleWynwoodDinnerChoice(elements);
                       }
                   });
               });
           });

            // Add listener for vehicle card selection (clears error on change)
            const vehicleCardRadios = document.querySelectorAll('.vehicle-card input[type="radio"][name="vehicle_type_oneway"]');
            vehicleCardRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    clearError('vehicle_type_oneway'); // Clear the specific error for the vehicle group
                });
            });


           // Form Submission
           elements.bookingForm?.addEventListener('submit', (event) => {
               event.preventDefault();
               // clearAllErrors(elements); // Moved inside validateForm
               if (validateForm(elements)) {
                   const data = processFormData(elements);
                   sendFormData(data, elements, config);
               } else {
                   // Focus first error field
                   const firstErrorField = elements.bookingForm.querySelector('[aria-invalid="true"], .border-red-500, fieldset.ring-red-500 input[type="radio"], fieldset.ring-red-500 input[type="checkbox"]');
                   const firstFieldsetError = elements.bookingForm.querySelector('fieldset.ring-red-500');
                   const firstButtonError = elements.bookingForm.querySelector('.booking-time-button.border-red-500');

                   let elementToFocus = firstErrorField || firstButtonError; // Prioritize inputs/buttons
                   if (!elementToFocus && firstFieldsetError) {
                       elementToFocus = firstFieldsetError.querySelector('input[type="radio"], input[type="checkbox"]');
                   }

                   if (elementToFocus) {
                       elementToFocus.focus({ preventScroll: true });
                       elementToFocus.scrollIntoView({ behavior: 'smooth', block: 'center' });
                   }
                    showError(elements, 'submit-button', 'Please review the errors above.');
               }
           });

            // Accessibility Boost: Set aria-checked dynamically for vehicle cards
            vehicleCardRadios.forEach(radio => {
                radio.setAttribute('aria-checked', radio.checked ? 'true' : 'false'); // Initial state
                radio.addEventListener('change', () => {
                    vehicleCardRadios.forEach(r => {
                        r.setAttribute('aria-checked', r.checked ? 'true' : 'false');
                    });
                });
            });


           console.log("Event listeners initialized.");
        }


        // --- Main Execution ---
        const elementRefs = getElementRefs();
        const appConfig = config;

        if (elementRefs.bookingForm) {
          initializeFlatpickr(elementRefs); // Initializes Hourly pickers
          initializeEventListeners(elementRefs, appConfig.placeholders, appConfig);
          switchTab('#panel-oneway', elementRefs, appConfig.placeholders); // Set initial state
        } else {
          console.error("Booking form not found. Script initialization incomplete.");
        }
      });
    </script>
    <script src="dashboard.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          const response = await fetch('/.netlify/functions/get-maps-key');
          if (!response.ok) {
            throw new Error('Failed to fetch API key');
          }
          const data = await response.json();
          const apiKey = data.apiKey;
          if (apiKey) {
            const script = document.createElement('script');
            // Add additional logic here if needed
          }
        } catch (error) {
          console.error('Error fetching API key:', error);
        }
      });
    </script>
  </body>
</html>


